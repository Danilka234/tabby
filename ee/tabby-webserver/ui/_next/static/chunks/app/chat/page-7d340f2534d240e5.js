(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1929],{14454:function(e,n,t){Promise.resolve().then(t.bind(t,76842))},76842:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return e1}});var s=t(36164),a=t(3546),r=t(42891),l=t.n(r),i=t(11978),o=t(23342),d=t(94755),c=t(47190),u=t.n(c),m=t(42450),h=t(36982),f=t(93668),v=t(11075),p=t(14439),x=t(31458),g=t(81565),j=t(1853),y=t(78613),b=t(82157),N=t(77735),w=t(72940),C=t(70783),k=t(40055),I=t(21808),S=t(18500),M=t(24449),T=t(16784),E=t(31159),R=t(64566),A=t(63484),L=t(17451),Z=t(70410),_=t(57288),U=t(6230),F=t(3448),D=t(17448),z=t(54767),P=t(28445),V=t(84837),O=t(2578),K=t(28312),H=t(11634),q=t(63795),W=t(72657),J=t(77246),$=t(29952),B=t(94160),G=t(50292),Q=t(59105),Y=t(44516),X=t(19092);t(67325);var ee=t(12978),en=t(31022),et=t(70834),es=t(18366);let ea=(0,es.Z)();var er=t(63057),el=t(31745),ei=t(65063),eo=t(74787);let ed=e=>{let{node:n}=e,{category:t,fileItem:r,label:l}=n.attrs;return(0,a.useEffect)(()=>(ea.emit("file_mention_update"),()=>{ea.emit("file_mention_update")}),[]),(0,s.jsx)(Y.T5,{as:"span",className:"rounded-sm px-1",children:(0,s.jsxs)("span",{className:(0,_.cn)("space-x-0.5 whitespace-nowrap rounded bg-muted px-1.5 py-0.5 align-middle text-sm font-medium text-foreground"),"data-category":t,children:["file"===t?(0,s.jsx)(er.Z,{className:"relative -top-px inline-block h-3.5 w-3.5"}):(0,s.jsx)(el.Z,{className:"relative -top-px inline-block h-3.5 w-3.5"}),(0,s.jsx)("span",{className:"relative whitespace-normal",children:l})]})})},ec=$.ZP.extend({addNodeView:()=>(0,Y.fW)(ed),renderText(e){let{node:n}=e,t=n.attrs.fileItem,s=t.filepath,a=n.attrs.category;return"symbol"===a?"[[symbol:".concat(JSON.stringify(n.attrs.fileItem),"]]"):"[[file:".concat(JSON.stringify(s),"]]")},addAttributes:()=>({id:{default:null,parseHTML:e=>e.getAttribute("data-file"),renderHTML:e=>e.fileItem?{"data-id":JSON.stringify(e.fileItem.filepath)}:{}},fileItem:{default:null,parseHTML:e=>e.getAttribute("data-file"),renderHTML:e=>e.fileItem?{"data-file":e.fileItem}:{}},category:{default:"file",parseHTML:e=>e.getAttribute("data-category"),renderHTML:e=>e.category?{"data-category":e.category}:{}},label:{default:"",parseHTML:e=>e.getAttribute("data-label"),renderHTML:e=>e.label?{"data-label":e.label}:{}}})}),eu=(0,a.forwardRef)((e,n)=>{let{items:t,command:r,query:l,listFileInWorkspace:i,listSymbols:o}=e,[d,c]=(0,a.useState)(t),[u,m]=(0,a.useState)(0),[h,f]=(0,a.useState)("category"),[v,p]=(0,a.useState)(!1),[x]=(0,M.n)(v,100),[j,y]=(0,a.useState)(!0),[b]=(0,M.n)(l||"",150),N=(0,a.useRef)(null),w=(0,a.useMemo)(()=>{let e=[i&&{label:"Files",categoryKind:"file",icon:(0,s.jsx)(er.Z,{className:"h-4 w-4"})},o&&{label:"Symbols",categoryKind:"symbol",icon:(0,s.jsx)(el.Z,{className:"h-4 w-4"})}].filter(Boolean);return 1===e.length&&f(e[0].categoryKind),e},[i,o]),C=1===w.length,k=!C&&"category"===h,I=(0,a.useCallback)(async()=>{p(!0);try{var e;let n=j?l:b;N.current&&(N.current.isCurrent=!1);let t=(async()=>{let e=[];if(k){let t=await (null==i?void 0:i({query:n||""}))||[];e=n?t.map(eo.Gn):[...w.map(e=>({id:e.categoryKind,name:e.label,category:"category",isRootCategoryItem:!0,fileItem:{},icon:e.icon})),...t.map(eo.Gn)]}else if("file"===h){let t=await (null==i?void 0:i({query:n}))||[];e=t.map(eo.Gn)}else{let t=await (null==o?void 0:o({query:n}))||[];e=(0,ee.Z)(t.map(eo.xe),"id")}return e})();t.isCurrent=!0,N.current=t;let s=await t;(null===(e=N.current)||void 0===e?void 0:e.isCurrent)&&(c(s),m(0),p(!1),j&&y(!1))}catch(e){p(!1)}},[w,b,j,i,o,h,l,k]);(0,a.useEffect)(()=>{I()},[h,l,b,j,k,I]),(0,a.useEffect)(()=>()=>{N.current&&(N.current.isCurrent=!1)},[]);let S=e=>{if(e.isRootCategoryItem&&!C){f(e.id);return}let n="file"===e.category?(0,_.UA)((0,_.eo)(e.fileItem.filepath).filepath||""):e.name;r({category:e.category,fileItem:e.fileItem,label:n})};return(0,a.useImperativeHandle)(n,()=>({onKeyDown:e=>{let{event:n}=e;if(v)return!1;let t=d.length-1,s=u;switch(n.key){case"ArrowUp":s=Math.max(0,u-1);break;case"ArrowDown":s=Math.min(t,u+1);break;case"Enter":return d[u]&&(S(d[u]),d[u].isRootCategoryItem&&m(0)),!0;default:return!1}return m(s),!0}})),(0,s.jsxs)("div",{className:"relative flex max-h-[300px] min-w-[60vw] max-w-[90vw] flex-col overflow-hidden rounded-md border bg-background p-1",children:[x&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-background/80",children:(0,s.jsx)(ei.Z,{className:"h-6 w-6 animate-spin"})}),!C&&"category"!==h&&(0,s.jsxs)("div",{className:"flex items-center p-1 text-sm text-muted-foreground",children:[(0,s.jsx)("button",{className:"mr-2 rounded p-1 hover:bg-accent",onClick:()=>f("category"),children:(0,s.jsx)(g.IconChevronLeft,{className:"h-4 w-4"})}),"file"===h?"Files":"Symbols"]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===d.length?(0,s.jsx)("div",{className:"px-2 py-1.5 text-xs text-muted-foreground",children:l?"No results found":"Type to search..."}):(0,s.jsx)("div",{className:"grid gap-0.5",children:d.map((e,n)=>(0,s.jsx)(em,{onClick:()=>S(e),onMouseEnter:()=>m(n),title:e.name,isSelected:n===u,data:e},"".concat(e.id,"-").concat(n)))})})]})});function em(e){let{isSelected:n,data:t,...r}=e,l=(0,a.useRef)(null),i=(0,a.useMemo)(()=>t.filepath&&t.filepath?t.filepath.split("/").slice(0,-1).join("/"):"",[t.filepath]);return(0,a.useLayoutEffect)(()=>{if(n&&l.current){var e;null===(e=l.current)||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})}},[n]),(0,s.jsxs)("div",{className:(0,_.cn)("flex cursor-pointer flex-nowrap items-center gap-1 overflow-hidden rounded-md px-2 py-1.5 text-sm",{"bg-accent text-accent-foreground":n}),...r,ref:l,children:[(0,s.jsx)("span",{className:"flex h-5 shrink-0 items-center",children:t.icon}),(0,s.jsx)("span",{className:"mr-2 truncate whitespace-nowrap",children:t.name}),(0,s.jsx)("span",{className:"flex-1 truncate text-xs text-muted-foreground",children:i}),"category"===t.category&&(0,s.jsx)(g.IconChevronRight,{className:"h-4 w-4 text-muted-foreground"})]})}eu.displayName="MentionList";let eh=a.forwardRef((e,n)=>{let{onSubmit:t,isLoading:r,onUpdate:l,className:i,...o}=e,{listFileInWorkspace:d,readFileContent:c,relevantContext:u,setRelevantContext:m,listSymbols:h}=(0,a.useContext)(D.p),{selectedModel:f,models:v}=(0,E.Vq)(),p=(0,T.d)(async()=>{if(r||!y)return;let e=y.getText({blockSeparator:I.rZ}).trim();if(!e)return;let n=t(e);return null==y||y.chain().clearContent().focus().run(),n}),j=()=>{p.current()},y=(0,Y.jE)({extensions:[J.Z,B.Z,Q.Z,G.Z.configure({placeholder:d?"Ask anything, @ to mention":"Ask anything ..."}),ef(j),ec.configure({deleteTriggerWithBackspace:!0,suggestion:{allow:e=>{let{state:n,range:t}=e,s=n.doc.resolve(t.from),a=n.schema.nodes[$.ZP.name],r=!!s.parent.type.contentMatch.matchType(a);return!!d&&r},char:"@",items:async e=>{let{query:n}=e;if(!d)return[];let t=await d({query:n}),s=[...h?[null!=h?h:{id:"category",name:"Files",category:"category"},{id:"category",name:"Symbols",category:"category"}]:[],...(0,ee.Z)(t.map(eo.Gn),"id")];return s},render:()=>{let e,n;return{onStart:t=>{e=new Y.M_(eu,{props:{...t,listFileInWorkspace:d,listSymbols:h},editor:t.editor}),t.clientRect&&(n=(0,en.ZP)("body",{getReferenceClientRect:t.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"top-start",animation:"shift-away"}))},onUpdate:n=>{e.updateProps(n)},onExit:()=>{n[0].destroy(),e.destroy()},onKeyDown:t=>{var s,a;return"Escape"===t.event.key?(n[0].hide(),!0):null!==(a=null===(s=e.ref)||void 0===s?void 0:s.onKeyDown(t))&&void 0!==a&&a}}}}})],editorProps:{attributes:{class:(0,_.cn)("prose min-h-[3.5em] font-sans dark:prose-invert focus:outline-none prose-p:my-0")}},onUpdate(e){null==l||l(e)}},[d]),N=(null==y?void 0:y.getText())||"",w=e=>{y&&y.chain().focus().command(n=>{var t,s,a;let{tr:r,state:l}=n,{$from:i}=l.selection,o=0===i.parentOffset,d=null!==(a=null===(s=i.nodeBefore)||void 0===s?void 0:null===(t=s.text)||void 0===t?void 0:t.endsWith(" "))&&void 0!==a&&a;return o||d?r.insertText(e):r.insertText(" "+e),!0}).run()};(0,a.useImperativeHandle)(n,()=>({focus:()=>null==y?void 0:y.commands.focus(),setInput:e=>null==y?void 0:y.commands.setContent(e),input:N,editor:y}),[y,N]);let C=(0,M.S)(async()=>{if(!c||!y)return;let e=[];y.view.state.doc.descendants(n=>{"mention"===n.type.name&&("file"===n.attrs.category||"symbol"===n.attrs.category)&&e.push({kind:"file",content:"",filepath:n.attrs.fileItem.filepath,range:"symbol"===n.attrs.category?n.attrs.fileItem.range:void 0})});let n=[...u],t=e.filter(e=>!u.some(n=>(0,eo.jZ)((0,_.VU)(e),n))),s=u.filter(n=>!e.some(e=>(0,eo.jZ)((0,_.VU)(e),n)));for(let e of s)n=n.filter(n=>!(0,b.Z)(n,e));for(let e of t){let t=await c({filepath:e.filepath,range:e.range});n.push((0,_.VU)({kind:"file",content:t||"",filepath:e.filepath,range:e.range}))}m(n)},100);return(0,a.useEffect)(()=>{let e=()=>{C.run()};return ea.on("file_mention_update",e),()=>{ea.off("file_mention_update",e)}},[]),(0,s.jsxs)("div",{className:(0,_.cn)("relative flex flex-col",i),...o,children:[(0,s.jsx)("div",{className:"relative flex items-start gap-1.5",children:(0,s.jsx)("div",{className:"max-h-32 flex-1 overflow-y-auto py-3",onClick:()=>{y&&!y.isFocused&&(null==y||y.commands.focus())},children:(0,s.jsx)(Y.kg,{editor:y,className:(0,_.cn)("prose overflow-hidden break-words text-foreground focus:outline-none")})})}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"-ml-1.5 flex items-center gap-2",children:[!!d&&(0,s.jsx)(x.z,{variant:"ghost",className:"h-auto shrink-0 gap-2 p-1.5 text-foreground/90",onClick:e=>w("@"),children:(0,s.jsx)(g.IconAtSign,{})}),(0,s.jsx)(et.q,{models:v,value:f,onChange:e=>{(0,L.Eg)(e),setTimeout(()=>{null==y||y.chain().focus().run()})},triggerClassName:"gap-1 py-1 h-auto"})]}),(0,s.jsx)(x.z,{className:"h-6 w-6",size:"icon",disabled:r||""===N,onClick:j,children:(0,s.jsx)(g.IconArrowRight,{className:"h-3 w-3"})})]})]})});eh.displayName="PromptForm";let ef=e=>X.hj.create({addKeyboardShortcuts(){return{Enter:n=>{let{editor:t}=n;return e(),!0},"Shift-Enter":()=>this.editor.commands.first(e=>{let{commands:n}=e;return[()=>n.newlineInCode(),()=>n.createParagraphNear(),()=>n.liftEmptyBlock(),()=>n.splitBlock()]})}}});var ev=t(29),ep=t(36065),ex=t(84942),eg=t(37034);function ej(e){let{repos:n,value:t,onChange:r,isInitializing:l,...i}=e,[o,d]=(0,a.useState)(!1),c=(0,a.useRef)(null),u=e=>{r(e)},m=()=>{requestAnimationFrame(()=>{c.current&&(c.current.scrollTop=0)})},h=t?null==n?void 0:n.find(e=>e.sourceId===t):void 0,f=null==h?void 0:h.sourceName;return l||(null==n?void 0:n.length)?(0,s.jsx)("div",{...i,children:(0,s.jsx)(U.Z,{loading:l,fallback:(0,s.jsx)("div",{className:"w-full pl-2",children:(0,s.jsx)(F.O,{className:"h-3 w-[10rem]"})}),children:(0,s.jsxs)(ex.J2,{open:o,onOpenChange:d,children:[(0,s.jsxs)(q.C,{variant:"outline",className:(0,_.cn)("h-7 w-full items-center gap-1 overflow-hidden break-all rounded-md px-0 text-sm font-semibold hover:bg-muted/50",{"border-dashed text-muted-foreground italic":!h}),children:[(0,s.jsx)(ex.xo,{className:"outline-none",asChild:!0,children:(0,s.jsxs)("div",{className:(0,_.cn)("flex flex-1 cursor-pointer items-center gap-1.5 overflow-hidden pl-2.5",{"min-w-[10rem]":!h}),children:[h?(0,s.jsx)(eg.k,{kind:h.sourceKind,className:"h-3.5 w-3.5 shrink-0"}):(0,s.jsx)(g.IconFolderGit,{className:"shrink-0"}),(0,s.jsx)("div",{className:"flex flex-1 items-center gap-1.5 truncate break-all",children:(0,s.jsx)("span",{className:(0,_.cn)("truncate",{"text-muted-foreground":!f}),children:f||"Workspace"})}),!t&&(0,s.jsx)("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center text-foreground",children:(0,s.jsx)(g.IconChevronUpDown,{})})]})}),!!t&&(0,s.jsx)(x.z,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0 rounded-l-none bg-background hover:bg-muted/50",onClick:e=>{e.stopPropagation(),r(void 0)},children:(0,s.jsx)(g.IconRemove,{})})]}),(0,s.jsx)(ex.yk,{side:"top",align:"start",className:"dropdown-menu w-[80vw] overflow-x-hidden rounded-md border bg-popover p-2 text-popover-foreground shadow animate-in",children:(0,s.jsxs)(ep.mY,{children:[(0,s.jsx)(ep.sZ,{placeholder:"Select repository ...",onValueChange:()=>{m()}}),(0,s.jsxs)(ep.e8,{className:"max-h-[30vh]",ref:c,children:[(0,s.jsx)(ep.rb,{children:"No repository found"}),(0,s.jsx)(ep.fu,{children:null==n?void 0:n.map(e=>{let n=e.sourceId===t;return(0,s.jsxs)(ep.di,{onSelect:()=>{u(e.sourceId),d(!1)},title:e.sourceName,className:"cursor-pointer",children:[(0,s.jsx)(g.IconCheck,{className:(0,_.cn)("mr-1 shrink-0",e.sourceId===t?"opacity-100":"opacity-0")}),(0,s.jsxs)("div",{className:"flex flex-1 items-center gap-1 overflow-x-hidden",children:[(0,s.jsx)(eg.k,{kind:e.sourceKind,className:"shrink-0"}),(0,s.jsx)("div",{className:(0,_.cn)("truncate font-medium",{"font-semibold":n}),children:e.sourceName})]})]},e.sourceId)})})]})]})})]})})}):null}let ey=a.forwardRef((e,n)=>{var t;let{stop:r,reload:l,className:i,onSubmit:o,onUpdate:c,chatInputRef:u}=e,{threadId:m,container:h,onClearMessages:f,qaPairs:v,isLoading:p,relevantContext:y,activeSelection:b,onCopyContent:N,selectedRepoId:w,setSelectedRepoId:C,repos:k,initialized:S,setRelevantContext:M,openInEditor:E}=a.useContext(D.p),R=(0,L.aK)(e=>e.enableActiveSelection),[A,U]=(0,a.useState)(!1),{width:F}=(0,d.iP)(),J="number"==typeof F&&F<376,$=(0,a.useMemo)(()=>{var e;if(!m)return"";let n=null===(e=v[0])||void 0===e?void 0:e.user.message;if(!n)return m;let t=(0,_.i8)([],n,{maxLength:I.$I}),s=(0,z.Z)(t),a=(0,j.Z)([s,m]).join("-");return a},[null===(t=v[0])||void 0===t?void 0:t.user.message,m]),B=(0,H.Db)(Z.md,{onError(e){O.A.error(e.message)}}),{isCopied:G,copyToClipboard:Q}=(0,K.m)({timeout:2e3,onCopyContent:N}),Y=async()=>{if(m&&!G&&!A)try{var e,n;U(!0);let t=await B({threadId:m});if(null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.setThreadPersisted){let e=new URL(window.location.origin);e.pathname="/search/".concat($),Q(e.toString())}else O.A.error((null==t?void 0:null===(n=t.error)||void 0===n?void 0:n.message)||"Failed to share")}catch(e){}finally{U(!1)}},X=(0,T.d)(e=>{var n;let t=null===(n=u.current)||void 0===n?void 0:n.editor;if(!t)return;let{state:s,view:a}=t,{tr:r}=s,l=[],i=y[e];s.doc.descendants((e,n)=>{if("mention"===e.type.name&&("file"===e.attrs.category||"symbol"===e.attrs.category)){let t=(0,_.VU)({filepath:e.attrs.fileItem.filepath,content:"",kind:"file",range:"symbol"===e.attrs.category?e.attrs.fileItem.range:void 0});(0,eo.jZ)(t,i)&&l.push({from:n,to:n+e.nodeSize})}}),M(n=>n.filter((n,t)=>t!==e)),l.reverse().forEach(e=>{let{from:n,to:t}=e;r.delete(n,t)}),a.dispatch(r),t.commands.focus()});return a.useImperativeHandle(n,()=>{var e,n;return{focus:()=>{var e;null===(e=u.current)||void 0===e||e.focus()},setInput:e=>{var n;null===(n=u.current)||void 0===n||n.setInput(e)},input:null!==(n=null===(e=u.current)||void 0===e?void 0:e.input)&&void 0!==n?n:""}},[u]),(0,s.jsxs)("div",{className:i,children:[(0,s.jsx)(W.K,{container:h}),(0,s.jsxs)("div",{className:"mx-auto max-w-5xl px-[16px]",children:[(0,s.jsxs)("div",{className:(0,_.cn)("mb-1 flex h-10 items-center justify-center",J?"gap-3":"gap-2"),children:[p?(0,s.jsxs)(ev.u,{children:[(0,s.jsx)(ev.aJ,{asChild:!0,children:(0,s.jsxs)(x.z,{variant:"outline",onClick:()=>r(),className:"gap-2 bg-background",children:[(0,s.jsx)(g.IconStop,{}),!J&&"Stop generating"]})}),(0,s.jsx)(ev._v,{hidden:!J,children:"Stop generating"})]}):(null==v?void 0:v.length)>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(ev.u,{children:[(0,s.jsx)(ev.aJ,{asChild:!0,children:(0,s.jsxs)(x.z,{variant:"outline",onClick:()=>l(),className:"gap-2 bg-background",children:[(0,s.jsx)(g.IconRefresh,{}),!J&&"Regenerate"]})}),(0,s.jsx)(ev._v,{hidden:!J,children:"Regenerate"})]}),(0,s.jsxs)(ev.u,{children:[(0,s.jsx)(ev.aJ,{asChild:!0,children:(0,s.jsxs)(x.z,{variant:"outline",className:"gap-2 bg-background",onClick:Y,children:[G?(0,s.jsx)(g.IconCheck,{}):(0,s.jsx)(g.IconShare,{}),!J&&"Share"]})}),(0,s.jsx)(ev._v,{hidden:!J,children:"Share"})]})]}),(null==v?void 0:v.length)>0&&(0,s.jsxs)(ev.u,{children:[(0,s.jsx)(ev.aJ,{asChild:!0,children:(0,s.jsxs)(x.z,{variant:"outline",onClick:f,className:"gap-2 bg-background",children:[(0,s.jsx)(g.IconTrash,{}),!J&&"Clear"]})}),(0,s.jsx)(ev._v,{hidden:!J,children:"Clear"})]})]}),(0,s.jsxs)("div",{id:"chat-panel-container",className:"rounded-md border bg-background px-4 pb-1.5 pt-3 outline-none transition-shadow duration-300 focus-within:ring-1 focus-within:!ring-ring hover:ring-1 hover:ring-ring/60 focus-visible:ring-offset-2",children:[(0,s.jsxs)("div",{className:"flex w-full flex-wrap gap-1.5",children:[(0,s.jsx)(ej,{id:"repo-select",className:"overflow-hidden",value:w,onChange:e=>{C(e),setTimeout(()=>{var e;null===(e=u.current)||void 0===e||e.focus()})},repos:k,isInitializing:!S}),b?(0,s.jsxs)(q.C,{id:"active-selection-badge",variant:"outline",className:(0,_.cn)("inline-flex h-7 flex-nowrap items-center gap-1.5 overflow-hidden rounded-md border pr-0 text-sm font-semibold",{"border-dashed !text-muted-foreground italic line-through":!R}),children:[(0,s.jsx)(g.IconFileText,{className:"shrink-0"}),(0,s.jsx)(eb,{context:b,className:"flex-1 truncate"}),(0,s.jsx)("span",{className:"shrink-0 text-muted-foreground",children:"Current file"}),(0,s.jsx)(x.z,{size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0 rounded-l-none hover:bg-muted/50",onClick:e=>{(0,L.qs)(!R)},children:R?(0,s.jsx)(g.IconEye,{}):(0,s.jsx)(g.IconEyeOff,{})})]}):null,(0,s.jsx)(P.M,{children:y.map((e,n)=>{var t,a;let r="".concat(e.gitUrl,"_").concat(e.filepath,"_").concat(null===(t=e.range)||void 0===t?void 0:t.start,"_").concat(null===(a=e.range)||void 0===a?void 0:a.end);return(0,s.jsx)(V.E.div,{initial:{opacity:0,scale:.9,y:-5},animate:{opacity:1,scale:1,y:0},transition:{ease:"easeInOut",duration:.1},exit:{opacity:0,scale:.9,y:-5},layout:!0,className:"overflow-hidden",children:(0,s.jsxs)(q.C,{variant:"outline",className:(0,_.cn)("inline-flex h-7 w-full cursor-pointer flex-nowrap items-center gap-1 overflow-hidden rounded-md pr-0 text-sm font-semibold"),onClick:()=>{E((0,_.Uw)(e))},children:[(0,s.jsx)(g.IconFileText,{className:"shrink-0"}),(0,s.jsx)(eb,{context:e}),(0,s.jsx)(x.z,{size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0 rounded-l-none hover:bg-muted/50",onClick:e=>{e.stopPropagation(),X.current(n)},children:(0,s.jsx)(g.IconRemove,{})})]})},r)})})]}),(0,s.jsx)(eh,{ref:u,onSubmit:o,onUpdate:c,isLoading:p})]})]})]})});function eb(e){let{context:n,className:t}=e,a=n.range?n.range.start===n.range.end?":".concat(n.range.start):":".concat(n.range.start,"-").concat(n.range.end):"";return(0,s.jsxs)("span",{className:(0,_.cn)("truncate",t),children:[(0,_.UA)(n.filepath),!!n.range&&(0,s.jsx)("span",{className:"text-muted-foreground",children:a})]})}ey.displayName="ChatPanel";var eN=t(76297),ew=t(12624);function eC(e){let{trackVisibility:n}=e,{container:t}=a.useContext(D.p),r=(0,ew.e)(100,t),{ref:l,entry:i,inView:o}=(0,eN.YD)({trackVisibility:n,delay:100,rootMargin:"0px 0px -150px 0px",root:t});return a.useEffect(()=>{r&&n&&!o&&(null==i||i.target.scrollIntoView({block:"start"}))},[o,i,r,n]),(0,s.jsx)("div",{ref:l,className:"h-px w-full"})}var ek=t(83171);function eI(e){var n,t,a;let{data:r,sources:l,fetchingSources:i,onNavigate:o,onDeleteThread:d}=e,c=r.node.id,[{data:u,fetching:m}]=(0,k.aM)({query:Z.r4,variables:{first:1,threadId:c}}),h=null==u?void 0:null===(n=u.threadMessages)||void 0===n?void 0:n.edges;return(0,s.jsx)("div",{onClick:e=>o(r.node.id),className:"group cursor-pointer overflow-hidden rounded-md bg-background/70 px-4 py-3 transition-colors hover:bg-accent/60",children:(0,s.jsxs)("div",{className:"flex flex-nowrap justify-between gap-2 overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex-1 overflow-hidden",children:[(0,s.jsx)(U.Z,{loading:m||i,fallback:(0,s.jsx)("div",{className:"w-full py-1.5",children:(0,s.jsx)(F.O,{className:"w-[60%]"})}),children:(0,s.jsx)(ek.fh,{className:"break-anywhere truncate text-base font-medium text-foreground/90",sources:l,message:(0,eo.HV)(null!==(a=null==h?void 0:null===(t=h[0])||void 0===t?void 0:t.node.content)&&void 0!==a?a:"")})}),(0,s.jsx)("div",{className:"mt-1 truncate whitespace-nowrap text-xs text-muted-foreground",children:(0,_.sx)(r.node.createdAt,"Asked")})]}),!!d&&(0,s.jsx)(x.z,{size:"icon",variant:"hover-destructive",className:"hidden shrink-0 p-0 group-hover:flex",onClick:e=>{e.stopPropagation(),d(r.node.id)},children:(0,s.jsx)(g.IconTrash,{})})]})})}let eS=[{heading:"Convert list of string to numbers",message:"How to convert a list of string to numbers in python"},{heading:"How to parse email address",message:"How to parse email address with regex"}];function eM(e){var n;let{setInput:t,welcomeMessage:r,setShowHistory:l,onSelectThread:i}=e,[{data:o}]=(0,k.aM)({query:Z.rm,variables:{last:5}}),d=(0,a.useMemo)(()=>{var e,n;return null==o?void 0:null===(n=o.myThreads)||void 0===n?void 0:null===(e=n.edges)||void 0===e?void 0:e.slice(-5).reverse()},[null==o?void 0:null===(n=o.myThreads)||void 0===n?void 0:n.edges]),c=e=>{i(e),l(!1)};return(0,s.jsxs)("div",{className:"mx-auto max-w-5xl",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"mb-2 text-2xl font-semibold",children:r||"Welcome"}),(0,s.jsx)("p",{className:"leading-normal text-muted-foreground",children:"You can start a conversation here or try the following examples:"}),(0,s.jsx)("div",{className:"mt-4 flex flex-col items-start space-y-2",children:eS.map((e,n)=>(0,s.jsxs)(x.z,{variant:"link",className:"h-auto p-0 text-base",onClick:()=>t(e.message),children:[(0,s.jsx)(g.IconArrowRight,{className:"mr-2 text-muted-foreground"}),(0,s.jsx)("p",{className:"text-left",children:e.heading})]},n))})]}),(0,s.jsxs)("div",{className:"mt-10",children:[(0,s.jsx)("div",{className:"mb-3 flex items-center gap-2",children:(0,s.jsx)("span",{className:"text-lg font-semibold",children:"Recent Activities"})}),(0,s.jsx)("div",{className:"space-y-4",children:null==d?void 0:d.map(e=>(0,s.jsx)(eI,{data:e,onNavigate:c,sources:void 0},e.node.id))}),(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)(x.z,{size:"sm",variant:"ghost",onClick:e=>l(!0),className:"mt-4 text-foreground/70",children:"View all history"})})]})]})}var eT=t(94909),eE=t(74630),eR=t(74038),eA=t(98454),eL=t(48537),eZ=t(54646),e_=t(11208),eU=t(52569),eF=t(65858);let eD=(0,a.forwardRef)((e,n)=>{var t,r;let{contexts:l,clientContexts:i,className:o,triggerClassname:d,onContextClick:c,enableTooltip:u,onTooltipClick:m,highlightIndex:h,showExternalLink:f,showClientCodeIcon:v,supportsOpenInEditor:p,title:x}=e,g=null!==(t=null==l?void 0:l.length)&&void 0!==t?t:0,j=null!==(r=null==i?void 0:i.length)&&void 0!==r?r:0,y=g+j,b=y>1,[N,w]=(0,a.useState)(y<=5?"references":void 0);return((0,a.useEffect)(()=>{y<=5?w("references"):w(void 0)},[y]),y)?(0,s.jsx)(eF.UQ,{type:"single",collapsible:!0,className:(0,_.cn)("bg-transparent text-foreground",o),ref:n,value:N,onValueChange:w,children:(0,s.jsxs)(eF.Qd,{value:"references",className:"my-0 border-0",children:[(0,s.jsx)(eF.o4,{className:(0,_.cn)("my-0 py-2 font-semibold outline-none focus-visible:ring-1 focus-visible:ring-ring",d),children:x||(0,s.jsx)("span",{className:"mr-2",children:"Read ".concat(y," file").concat(b?"s":"")})}),(0,s.jsxs)(eF.vF,{className:"space-y-2",children:[null==i?void 0:i.map((e,n)=>(0,s.jsx)(ez,{context:e,onContextClick:e=>null==c?void 0:c(e,!0),isHighlighted:h===n,clickable:p,showClientCodeIcon:v},"user-".concat(n))),l.map((e,n)=>(0,s.jsx)(ez,{context:e,onContextClick:e=>null==c?void 0:c(e,!1),enableTooltip:u,onTooltipClick:m,showExternalLinkIcon:f,isHighlighted:h===n+((null==i?void 0:i.length)||0)},"assistant-".concat(n)))]})]})}):null});function ez(e){var n,t,r,l,i,o,d;let{context:c,clickable:u=!0,onContextClick:m,enableTooltip:h,onTooltipClick:f,showExternalLinkIcon:v,showClientCodeIcon:p,isHighlighted:x}=e,[j,y]=(0,a.useState)(!1),b=c.range&&!(0,eE.Z)(null===(n=c.range)||void 0===n?void 0:n.start)&&!(0,eE.Z)(null===(t=c.range)||void 0===t?void 0:t.end)&&c.range.start<c.range.end,N=c.filepath.split("/"),w=N.slice(0,N.length-1).join("/"),C=null==c?void 0:null===(r=c.extra)||void 0===r?void 0:r.scores;return(0,s.jsxs)(ev.u,{open:j,onOpenChange:e=>{h&&C&&y(e)},delayDuration:0,children:[(0,s.jsx)(ev.aJ,{asChild:!0,children:(0,s.jsx)("div",{className:(0,_.cn)("rounded-md border p-2",{"cursor-pointer hover:bg-accent":u,"cursor-default pointer-events-auto":!u,"bg-accent transition-all":x}),onClick:e=>u&&(null==m?void 0:m(c)),children:(0,s.jsxs)("div",{className:"flex items-center gap-1 overflow-hidden",children:[(0,s.jsx)(g.IconFile,{className:"shrink-0"}),(0,s.jsxs)("div",{className:"flex-1 truncate",title:c.filepath,children:[(0,s.jsx)("span",{children:(0,_.UA)(c.filepath)}),c.range?(0,s.jsxs)(s.Fragment,{children:[(null===(l=c.range)||void 0===l?void 0:l.start)&&(0,s.jsxs)("span",{className:"text-muted-foreground",children:[":",c.range.start]}),b&&(0,s.jsxs)("span",{className:"text-muted-foreground",children:["-",c.range.end]})]}):null,(0,s.jsx)("span",{className:"ml-2 text-xs text-muted-foreground",children:w})]}),p&&(0,s.jsx)(g.IconFileSearch2,{className:"shrink-0 text-muted-foreground"}),v&&(0,s.jsx)(g.IconExternalLink,{className:"shrink-0 text-muted-foreground"})]})})}),(0,s.jsx)(ev._v,{align:"start",onClick:f,className:"cursor-pointer p-2",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"mb-2 font-semibold",children:"Scores"}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("span",{className:"w-20",children:"rrf:"}),null!==(i=null==C?void 0:C.rrf)&&void 0!==i?i:"-"]}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("span",{className:"w-20",children:"bm25:"}),null!==(o=null==C?void 0:C.bm25)&&void 0!==o?o:"-"]}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("span",{className:"w-20",children:"embedding:"}),null!==(d=null==C?void 0:C.embedding)&&void 0!==d?d:"-"]})]})]})})]})}function eP(e){let{messages:n}=e,{isLoading:t}=a.useContext(D.p);return(0,s.jsx)("div",{className:"relative",children:null==n?void 0:n.map((e,r)=>{let l=r===n.length-1;return(0,s.jsxs)(a.Fragment,{children:[(0,s.jsx)(eV,{isLoading:!!l&&t,message:e,isLastItem:l}),!l&&(0,s.jsx)(e_.Z,{className:"my-4"})]},e.user.id)})})}function eV(e){let{message:n,isLoading:t,isLastItem:a}=e,{user:r,assistant:l}=n;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eO,{message:r}),!!l&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e_.Z,{className:"my-4"}),(0,s.jsx)(eH,{message:l,userMessage:r,isLoading:t,userMessageId:r.id,enableRegenerating:a})]})]})}function eO(e){var n,t,r,l,i;let{message:o}=e,[{data:d}]=(0,eA.P)(),c=o.selectContext,{openInEditor:u,supportsOnApplyInEditorV2:m}=a.useContext(D.p),h=a.useMemo(()=>{var e,n;if(!(null==c?void 0:c.content))return"";let t=(null==c?void 0:c.filepath)&&null!==(e=(0,A.U$)(null==c?void 0:c.filepath)[0])&&void 0!==e?e:"";return"\n```".concat(t,"\n").concat(null!==(n=null==c?void 0:c.content)&&void 0!==n?n:"","\n","```","\n")},[c]),f=null;if(h&&o.selectContext){let{range:e,filepath:n}=o.selectContext;f={filepath:n,isMultiLine:!!e&&!(0,eE.Z)(null==e?void 0:e.start)&&!(0,eE.Z)(null==e?void 0:e.end)&&e.start<e.end}}return(0,s.jsxs)("div",{className:(0,_.cn)("group relative mb-4 flex flex-col items-start gap-y-2"),...e,children:[(0,s.jsxs)("div",{className:(0,_.cn)("flex min-h-[2rem] w-full items-center justify-between md:w-auto",{hidden:!(null==d?void 0:d.me.name)}),children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)("div",{className:"shrink-0 select-none rounded-full border bg-background shadow",children:(0,s.jsx)(eU.SQ,{className:"h-8 w-8",fallback:(0,s.jsx)("div",{className:"flex h-8 w-8 items-center justify-center",children:(0,s.jsx)(g.IconUser,{className:"h-8 w-8"})})})}),(0,s.jsx)("p",{className:"block text-sm font-bold",children:null==d?void 0:d.me.name})]}),(0,s.jsx)(eK,{...e})]}),(0,s.jsx)("div",{className:"group relative flex w-full justify-between gap-x-2",children:(0,s.jsxs)("div",{className:"flex-1 space-y-2 overflow-hidden px-1",children:[(0,s.jsx)(eZ.J,{message:o.message,canWrapLongLines:!0,supportsOnApplyInEditorV2:m,openInEditor:u}),f&&o.selectContext&&(0,s.jsxs)("div",{className:"flex cursor-pointer items-center gap-1 overflow-x-auto text-xs text-muted-foreground hover:underline",onClick:()=>{let e=o.selectContext;u((0,_.Uw)(e))},children:[(0,s.jsx)(g.IconFile,{className:"h-3 w-3"}),(0,s.jsxs)("p",{className:"flex-1 truncate pr-1",children:[(0,s.jsx)("span",{children:f.filepath}),(null===(t=o.selectContext)||void 0===t?void 0:null===(n=t.range)||void 0===n?void 0:n.start)&&(0,s.jsxs)("span",{children:[":",null===(r=o.selectContext)||void 0===r?void 0:r.range.start]}),f.isMultiLine&&(0,s.jsxs)("span",{children:["-",null===(i=o.selectContext)||void 0===i?void 0:null===(l=i.range)||void 0===l?void 0:l.end]})]})]})]})})]})}function eK(e){let{message:n}=e,{handleMessageAction:t,isLoading:r}=a.useContext(D.p);return(0,s.jsxs)(e$,{className:"opacity-0 group-hover:opacity-100",children:[!r&&(0,s.jsxs)(x.z,{variant:"ghost",size:"icon",onClick:e=>t(n.id,"edit"),children:[(0,s.jsx)(g.IconEdit,{}),(0,s.jsx)("span",{className:"sr-only",children:"Edit message"})]}),!r&&(0,s.jsxs)(x.z,{variant:"ghost",size:"icon",onClick:e=>t(n.id,"delete"),children:[(0,s.jsx)(g.IconTrash,{}),(0,s.jsx)("span",{className:"sr-only",children:"Delete message"})]})]})}function eH(e){let{message:n,userMessage:t,isLoading:r,userMessageId:l,enableRegenerating:i,...o}=e,{onApplyInEditor:d,onCopyContent:c,onLookupSymbol:u,openInEditor:m,openExternal:h,supportsOnApplyInEditorV2:f}=a.useContext(D.p),[v,p]=a.useState(void 0),x=a.useMemo(()=>{var e,t,s;return null!==(s=null==n?void 0:null===(e=n.relevant_code)||void 0===e?void 0:e.map(e=>({kind:"file",range:(0,_.OV)(e),filepath:e.filepath,content:e.content,gitUrl:e.gitUrl,commit:null!==(t=e.commit)&&void 0!==t?t:void 0})))&&void 0!==s?s:[]},[null==n?void 0:n.relevant_code]),g=a.useMemo(()=>{var e;return(0,C.Z)((0,j.Z)([t.activeContext,...null!==(e=null==t?void 0:t.relevantContext)&&void 0!==e?e:[]]),b.Z)},[t.activeContext,t.relevantContext]),y=(0,a.useMemo)(()=>{var e,n;let t=null!==(n=null==g?void 0:g.map(n=>({content:n.content,filepath:n.filepath,gitUrl:n.gitUrl,baseDir:n.baseDir,startLine:n.range?n.range.start:void 0,language:(0,A.U$)(null!==(e=n.filepath)&&void 0!==e?e:"")[0],isClient:!0})))&&void 0!==n?n:[];return t},[g]),N=(0,a.useMemo)(()=>{var e,n,t;let s=null!==(t=null==x?void 0:x.map(t=>{var s;return{content:t.content,filepath:t.filepath,gitUrl:null!==(e=t.gitUrl)&&void 0!==e?e:"",startLine:null===(s=t.range)||void 0===s?void 0:s.start,language:(0,A.U$)(null!==(n=t.filepath)&&void 0!==n?n:"")[0],isClient:!1}}))&&void 0!==t?t:[];return(0,j.Z)([...s])},[x]),w=!!d,k=(e,n)=>{if(n||!w)m((0,_.Uw)(e));else{let n=(0,_.XX)(window.location.href,e);h(n)}};return(0,s.jsxs)("div",{className:(0,_.cn)("group relative mb-4 flex flex-col items-start gap-y-2"),...o,children:[(0,s.jsxs)("div",{className:"flex min-h-[2rem] w-full items-center justify-between md:w-auto",children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)("div",{className:"shrink-0 select-none rounded-full border bg-background shadow",children:(0,s.jsx)(eJ,{className:"h-8 w-8"})}),(0,s.jsx)("p",{className:"block text-sm font-bold",children:"Tabby"})]}),(0,s.jsx)(eq,{message:n,userMessageId:l,enableRegenerating:i,attachmentCode:N})]}),(0,s.jsxs)("div",{className:"w-full flex-1 space-y-2 overflow-hidden px-1",children:[(0,s.jsx)(eD,{contexts:x,clientContexts:g,onContextClick:k,showExternalLink:w,supportsOpenInEditor:!!m,showClientCodeIcon:!w,highlightIndex:v}),!r||(null==n?void 0:n.message)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eZ.J,{message:n.message,onApplyInEditor:d,onCopyContent:c,attachmentClientCode:y,attachmentCode:N,onCodeCitationClick:e=>{let n={gitUrl:e.gitUrl,content:e.content,filepath:e.filepath,kind:"file",range:(0,_.OV)(e)};k(n,e.isClient)},onCodeCitationMouseEnter:e=>{p(e-1-0)},onCodeCitationMouseLeave:e=>{p(void 0)},canWrapLongLines:!r,onLookupSymbol:u,openInEditor:m,supportsOnApplyInEditorV2:f,activeSelection:t.activeContext}),!!n.error&&(0,s.jsx)(eZ.m,{error:n.error})]}):(0,s.jsx)(eW,{})]})]})}function eq(e){let{handleMessageAction:n,isLoading:t,onCopyContent:r}=a.useContext(D.p),{message:l,userMessageId:i,enableRegenerating:o,attachmentCode:d}=e,c=(0,a.useMemo)(()=>(function(e,n){var t;if(!n||(0,eT.Z)(n))return e;let s=e.replace(eR.Hc,e=>{let n=null==e?void 0:e.match(/\d+/);return"[".concat(n,"]")}).trim(),a=null!==(t=n.map((e,n)=>{let t=(0,_.tf)(e),s=(0,j.Z)([e.filepath,t]).join(":");return"[".concat(n+1,"] ").concat(s)}).join("\n"))&&void 0!==t?t:"";return"".concat(s,"\n\nCitations:\n").concat(a)})(l.message,d),[l.message,d]);return(0,s.jsxs)(e$,{children:[!t&&o&&(0,s.jsxs)(x.z,{variant:"ghost",size:"icon",onClick:e=>n(i,"regenerate"),children:[(0,s.jsx)(g.IconRefresh,{}),(0,s.jsx)("span",{className:"sr-only",children:"Regenerate message"})]}),(0,s.jsx)(eL.q,{value:c,onCopyContent:r})]})}function eW(){return(0,s.jsxs)("div",{className:"space-y-2 py-2",children:[(0,s.jsx)(F.O,{className:"h-3 w-full"}),(0,s.jsx)(F.O,{className:"h-3 w-full"})]})}function eJ(e){let{className:n}=e;return(0,s.jsx)(l(),{style:{backgroundColor:"#E8E2D2"},className:(0,_.cn)("rounded-full p-0.5",n),src:o.Z,alt:"tabby"})}function e$(e){let{className:n,...t}=e;return(0,s.jsx)("div",{className:(0,_.cn)("flex items-center justify-end transition-opacity",n),...t})}eD.displayName="CodeReferences";let eB=a.forwardRef((e,n)=>{var t,r;let{className:l,threadId:i,setThreadId:o,initialMessages:d,onLoaded:c,onThreadUpdates:u,container:m,docQuery:h,generateRelevantQuestions:f,welcomeMessage:v,promptFormClassname:p,onCopyContent:x,onApplyInEditor:g,onLookupSymbol:z,openInEditor:P,openExternal:V,chatInputRef:O,supportsOnApplyInEditorV2:K,readWorkspaceGitRepositories:H,getActiveEditorSelection:q,fetchSessionState:W,storeSessionState:J,listFileInWorkspace:$,readFileContent:B,listSymbols:G,setShowHistory:Q,...Y}=e,[X,ee]=a.useState(),[en,et]=a.useState(!1),[es,ea]=a.useState(!1),er=a.useRef(!1),[el,ei]=a.useState(null!=d?d:[]),[ed,ec]=a.useState([]),[eu,em]=a.useState(null),[eh,ef]=a.useState();a.useEffect(()=>{i&&(ee(i),ei([]))},[i]);let[{data:ev,error:ep,fetching:ex,stale:eg}]=(0,k.aM)({query:Z.r4,variables:{threadId:i},pause:!i});a.useEffect(()=>{var e,n;(null==ev?void 0:null===(n=ev.threadMessages)||void 0===n?void 0:null===(e=n.edges)||void 0===e?void 0:e.length)&&i&&ei((e=>{let n=[],t={};return e.forEach(e=>{let s=e.node;if(s.role===S.uU.User){var a;t.user={id:s.id,message:s.content,relevantContext:null===(a=s.attachment.clientCode)||void 0===a?void 0:a.map(e=>{var n;return{kind:"file",content:e.content,filepath:null!==(n=e.filepath)&&void 0!==n?n:"",startLine:e.startLine,git_url:""}})}}else e.node.role===S.uU.Assistant&&!t.assistant&&(t.assistant={id:s.id,message:s.content,relevant_code:s.attachment.code},t.user&&t.assistant&&n.push(t))}),n})(ev.threadMessages.edges))},[ev]),a.useEffect(()=>{en&&(null==J||J({selectedRepoId:eh}))},[eh,en,J]);let ej=(0,L.aK)(e=>e.enableActiveSelection),eb=a.useRef(null),eN=e=>{var n;null===(n=eb.current)||void 0===n||n.setInput(e)},ew=null!==(r=null===(t=eb.current)||void 0===t?void 0:t.input)&&void 0!==r?r:"",[{data:ek,fetching:eI}]=(0,k.aM)({query:Z.K5}),eS=null==ek?void 0:ek.repositoryList,{selectedModel:eT}=(0,E.Vq)(),{sendUserMessage:eE,isLoading:eR,error:eA,answer:eL,stop:eZ,regenerate:e_,deleteThreadMessagePair:eU}=(0,R.x)({threadId:X}),eF=async e=>{var n;if(!X)return;eZ();let t=el.find(n=>n.user.id===e);if(!(null==t?void 0:t.user)||!t.assistant)return;let s=el.filter(n=>n.user.id!==e);ei(s),null==J||J({qaPairs:s}),eU(X,null==t?void 0:t.user.id,null==t?void 0:null===(n=t.assistant)||void 0===n?void 0:n.id)},eD=async e=>{if(!X)return;let n=(0,y.Z)(el,n=>n.user.id===e);if(n>-1){let e=el[n];if(!e.assistant)return;let t=(0,_.x0)(),s=(0,_.x0)();ei([...el.slice(0,n),{user:{...e.user,id:t},assistant:{id:s,message:"",error:void 0}}]);let[a,r]=await eq(e.user);return e_({threadId:X,userMessageId:e.user.id,assistantMessageId:e.assistant.id,userMessage:a,threadRunOptions:r})}},ez=async e=>{var n,t;if(!X)return;let s=el.find(n=>n.user.id===e);if(!(null==s?void 0:s.user)||!s.assistant)return;let a=s.user,r=[];(null===(n=a.relevantContext)||void 0===n?void 0:n.length)&&(r=r.concat(a.relevantContext));let l=(0,C.Z)(r,b.Z);ec(l);let i=el.filter(n=>n.user.id!==e);ei(i),null==J||J({qaPairs:i}),eN(a.message);let o=(0,eo._t)(a.message);eN({type:"doc",content:o}),a.activeContext&&P((0,_.Uw)(a.activeContext)),eU(X,null==s?void 0:s.user.id,null==s?void 0:null===(t=s.assistant)||void 0===t?void 0:t.id)},eV=async()=>{if(!(null==el?void 0:el.length))return;let e=el[el.length-1].user.id;return eD(e)},eO=()=>{eZ(!0),ei([]),ee(void 0),o(void 0),null==J||J({qaPairs:[],threadId:void 0})},eK=()=>{eO()};a.useEffect(()=>{if(!(null==el?void 0:el.length)||!eL)return;let e=el[el.length-1];eL.threadId&&!X&&ee(eL.threadId),ei(n=>{var t,s;let a=n[n.length-1].assistant,r={...a,id:eL.assistantMessageId||(null==a?void 0:a.id)||(0,_.x0)(),message:eL.content,error:void 0,relevant_code:null!==(s=null===(t=eL.attachmentsCode)||void 0===t?void 0:t.map(e=>e.code))&&void 0!==s?s:[]};return[...n.slice(0,n.length-1),{user:{...e.user,id:(null==eL?void 0:eL.userMessageId)||e.user.id},assistant:r}]}),eR||null==J||J({qaPairs:el})},[eL,eR]);let eH=(0,M.S)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"smooth";m?m.scrollTo({top:m.scrollHeight,behavior:e}):window.scrollTo({top:document.body.offsetHeight,behavior:e})},100);a.useLayoutEffect(()=>{eR&&eH.run()},[eR]),a.useEffect(()=>{eA&&(null==el?void 0:el.length)&&ei(e=>{var n,t,s;let a=e[e.length-1],r=[...e.slice(0,e.length-1),{...a,assistant:{...a.assistant,id:(null===(n=a.assistant)||void 0===n?void 0:n.id)||(0,_.x0)(),message:null!==(s=null===(t=a.assistant)||void 0===t?void 0:t.message)&&void 0!==s?s:"",error:eA?"401"===eA.message?"Unauthorized":(0,w.Z)(eA.graphQLErrors,e=>{var n;return(null===(n=e.extensions)||void 0===n?void 0:n.code)===I.ir})?"The thread has expired, please click 'Clear' and try again.":eA.message||"Failed to fetch":"Failed to fetch"}}];return null==J||J({qaPairs:r}),r}),(null==eA?void 0:eA.message)!=="Thread not found"||(null==el?void 0:el.length)||eK()},[eA]);let eq=async e=>{var n;let t=ej&&!!e.activeContext,s=(0,C.Z)((0,j.Z)([e.selectContext,t&&e.activeContext,...(null==e?void 0:e.relevantContext)||[]]),b.Z),a=s.map(e=>{var n;return{content:e.content,filepath:e.filepath,startLine:null===(n=e.range)||void 0===n?void 0:n.start}}),r=e.message,l=eh?{content:r,sourceId:eh,filepath:null==a?void 0:null===(n=a[0])||void 0===n?void 0:n.filepath}:null;return[{content:r,attachments:{code:a}},{docQuery:h?{content:r,searchPublic:!1}:null,generateRelevantQuestions:!!f,codeQuery:l,modelName:eT}]},eW=(0,T.d)(async e=>{var n,t,s,a,r;if(eR)return;let l="",i=null==e?void 0:null===(n=e.selectContext)||void 0===n?void 0:n.content;if(i){let n=(null==e?void 0:null===(t=e.selectContext)||void 0===t?void 0:t.filepath)&&null!==(a=(0,A.U$)(null==e?void 0:null===(s=e.selectContext)||void 0===s?void 0:s.filepath)[0])&&void 0!==a?a:"";l="\n```".concat(n,"\n").concat(null!=i?i:"","\n","```","\n")}let o={...e,message:e.message+l,id:null!==(r=e.id)&&void 0!==r?r:(0,_.x0)(),selectContext:e.selectContext,activeContext:ej&&eu?eu:void 0,relevantContext:[...e.relevantContext||[]]},d=[...el,{user:o,assistant:{id:(0,_.x0)(),message:"",error:void 0}}];ei(d),null==J||J({qaPairs:d});let c=await eq(o);eE(...c)}),eJ=e=>{var n;return null===(n=eW.current)||void 0===n?void 0:n.call(eW,e)},e$=(0,T.d)(async e=>{let n=(0,_.QZ)(e);eJ({message:n,selectContext:null!=eu?eu:void 0})}),eB=async e=>{var n;return null===(n=e$.current)||void 0===n?void 0:n.call(e$,e)},eG=async e=>{eJ({message:e,relevantContext:ed}),ec([])},eQ=(0,T.d)(e=>{ec(n=>{let t=function(e,n){let t=["content"],s=(e,n)=>(0,N.Z)(e,n,(e,n,s)=>{if(t.includes(s))return!0});return e.some(e=>s(e,n))?e:e.concat([n])}(n,e);return t})}),eY=e=>{var n;let t=(0,_.VU)(e);null===(n=eQ.current)||void 0===n||n.call(eQ,t)};a.useEffect(()=>{er.current&&(null==u||u(el))},[el]),a.useEffect(()=>{en&&(null==J||J({relevantContext:ed}))},[ed,en,J]);let eX=(0,M.S)(e=>{em(e)},300),e0=e=>{let n=e?(0,_.VU)(e):null;eX.run(n)},e1=()=>H?H():[],e5=async()=>null==q?void 0:q();return a.useEffect(()=>{let e=async()=>{let[e,n]=await Promise.all([null==W?void 0:W(),e5()]);if((null==e?void 0:e.threadId)&&ee(e.threadId),(null==e?void 0:e.qaPairs)&&ei(e.qaPairs),(null==e?void 0:e.input)&&eN(e.input),(null==e?void 0:e.relevantContext)&&ec(e.relevantContext),eH.run("instant"),(null==e?void 0:e.selectedRepoId)&&(null==eS?void 0:eS.find(n=>n.sourceId===e.selectedRepoId)))ef(e.selectedRepoId);else{let e=await e1();if((null==e?void 0:e.length)&&(null==eS?void 0:eS.length)){let n=e[0].url,t=(0,_.Ch)(eS.map(e=>({url:e.gitUrl,sourceId:e.sourceId})),n);t&&ef(t.sourceId)}}if(n){let e=(0,_.VU)(n);em(e)}};eI||en||e().finally(()=>{et(!0)})},[eI,en]),a.useEffect(()=>{en&&(null==c||c(),ea(!0))},[en]),a.useEffect(()=>{null==J||J({threadId:X})},[X]),a.useImperativeHandle(n,()=>({executeCommand:eB,stop:eZ,isLoading:eR,addRelevantContext:eY,focus:()=>{var e;return null===(e=eb.current)||void 0===e?void 0:e.focus()},updateActiveSelection:e0,newChat:eO}),[]),(0,s.jsx)(D.p.Provider,{value:{threadId:X,isLoading:eR,qaPairs:el,handleMessageAction:(e,n)=>{switch(n){case"delete":eF(e);break;case"regenerate":eD(e);break;case"edit":ez(e)}},onClearMessages:eK,container:m,onCopyContent:x,onApplyInEditor:g,onLookupSymbol:z,openInEditor:P,openExternal:V,relevantContext:ed,setRelevantContext:ec,chatInputRef:O,activeSelection:eu,supportsOnApplyInEditorV2:K,selectedRepoId:eh,setSelectedRepoId:ef,repos:eS,fetchingRepos:eI,initialized:es,listFileInWorkspace:$,readFileContent:B,listSymbols:G},children:(0,s.jsx)("div",{className:"flex justify-center overflow-x-hidden",...Y,children:(0,s.jsxs)("div",{className:"mx-auto w-full max-w-5xl px-[16px]",children:[es&&(0,s.jsxs)("div",{className:(0,_.cn)("pb-[200px] pt-4 md:pt-10",l),children:[(0,s.jsx)(U.Z,{loading:ex,triggerOnce:!1,fallback:(0,s.jsx)(F.O,{}),delay:200,children:(null==el?void 0:el.length)?(0,s.jsx)(eP,{messages:el}):(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(eM,{setInput:eN,welcomeMessage:v,setShowHistory:Q,onSelectThread:o})})}),(0,s.jsx)(eC,{trackVisibility:eR})]}),(0,s.jsx)(ey,{onSubmit:eG,className:(0,_.cn)("fixed inset-x-0 bottom-0 mb-4",p),stop:()=>{eZ()},reload:eV,input:ew,setInput:eN,onUpdate:e=>{en&&(null==J||J({input:e.editor.getJSON()}))},ref:eb,chatInputRef:O})]})})})});eB.displayName="Chat";var eG=t(73033);t(2596);var eQ=t(66794),eY=t(54173);function eX(e){var n,t;let{onClose:r,onNavigate:l}=e,[i,o]=(0,a.useState)(),[{data:d,fetching:c}]=(0,k.aM)({query:Z.rm,variables:{last:25,before:i}}),u=null==d?void 0:null===(n=d.myThreads)||void 0===n?void 0:n.pageInfo,m=(0,a.useMemo)(()=>{var e;return null==d?void 0:null===(e=d.myThreads)||void 0===e?void 0:e.edges.slice().reverse()},[null==d?void 0:null===(t=d.myThreads)||void 0===t?void 0:t.edges]),h=e=>{l(e),setTimeout(()=>{r()},100)},f=(0,H.Db)(Z.zW),v=e=>f({id:e});return(0,s.jsx)("div",{className:"fixed inset-0 z-10 overflow-hidden px-[16px] pt-4 md:pt-10",children:(0,s.jsxs)("div",{className:"mx-auto h-full max-w-5xl overflow-y-auto pb-8",children:[(0,s.jsxs)("div",{className:"editor-bg sticky top-0 flex items-center justify-between pb-3",children:[(0,s.jsx)("span",{className:"text-lg font-semibold",children:"History"}),(0,s.jsx)(x.z,{size:"sm",onClick:r,children:"Done"})]}),(0,s.jsxs)("div",{className:"mt-4 space-y-4",children:[null==m?void 0:m.map(e=>(0,s.jsx)(eI,{data:e,sources:void 0,onNavigate:h,onDeleteThread:v},e.node.id)),!!(null==u?void 0:u.hasPreviousPage)&&(0,s.jsx)(eY.d,{onLoad:()=>{let e=null==u?void 0:u.startCursor;if(e&&(null==d?void 0:d.myThreads.edges.length)&&d.myThreads.edges.findIndex(n=>n.cursor===e)>-1)o(e);else{var n;o(null==d?void 0:null===(n=d.myThreads.edges[0])||void 0===n?void 0:n.cursor)}},isFetching:c,children:(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(g.IconSpinner,{className:"h-6 w-6"})})})]})]})})}let e0=e=>u()(e).hsl().toString().replace(/hsla?\(/,"").replace(")","").split(",").slice(0,3).map((e,n)=>0===n?parseFloat(e).toFixed(1):e).join("");function e1(){let[e,n]=(0,a.useState)(!1),[t,r]=(0,a.useState)(!1),[c,u]=(0,a.useState)(null),[j,y]=(0,a.useState)(!1),[b,N]=(0,a.useState)(),[w,C]=(0,a.useState)(),[k,I]=(0,a.useState)([]),[S,M]=(0,a.useState)(null),[T,E]=(0,a.useState)(null),[R,A]=(0,a.useState)(!1),L=(0,a.useRef)(null),{width:Z}=(0,d.iP)(),_=(0,a.useRef)(Z),U=(0,a.useRef)(null),F=(0,i.useSearchParams)(),D=F.get("client"),z=!!D||void 0,P=(0,a.useRef)(),V=e=>{L.current?L.current.executeCommand(e):C(e)},O=(0,p.H)({init:e=>{L.current||(D&&(0,eQ.zr)(e.fetcherOptions),u(e.fetcherOptions),P.current=e.useMacOSKeyboardEventHandler)},executeCommand:async e=>V(e),showError:e=>{E(e)},cleanError:()=>{E(null)},addRelevantContext:e=>{if(L.current)L.current.addRelevantContext(e);else{let n=[...k];n.push(e),I(n)}},updateTheme:(e,n)=>{let t=e.split(";").filter(e=>e).map(e=>{let[n,t]=e.split(":"),s=t.trim(),a=s.startsWith("#")||s.startsWith("rgb");if(!a)return"".concat(n,": ").concat(t);let r=e0(s);return"".concat(n,": ").concat(r)}).join(";");document.documentElement.style.cssText=t,document.documentElement.className=n+" client client-".concat(D)},updateActiveSelection:e=>{L.current?L.current.updateActiveSelection(e):e&&M(e)},navigate:e=>{switch(e){case"history":y(!0);break;case"new-chat":var n;null===(n=L.current)||void 0===n||n.newChat(),y(!1)}}});(0,a.useEffect)(()=>{let e=()=>{setTimeout(()=>{var e;null===(e=U.current)||void 0===e||e.focus()},0)};return window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}}),(0,a.useEffect)(()=>{let e=(e,n)=>{null==O||O.onKeyboardEvent(e,{code:n.code,isComposing:n.isComposing,key:n.key,altKey:n.altKey,ctrlKey:n.ctrlKey,metaKey:n.metaKey,shiftKey:n.shiftKey,location:n.location,repeat:n.repeat,keyCode:n.keyCode})},n=n=>{P.current?n.metaKey&&"KeyC"===n.code?document.execCommand("copy"):n.metaKey&&"KeyX"===n.code?document.execCommand("cut"):n.metaKey&&"KeyV"===n.code?document.execCommand("paste"):n.metaKey&&"KeyA"===n.code?document.execCommand("selectAll"):e("keydown",n):e("keydown",n)},t=n=>{e("keyup",n)},s=n=>{e("keypress",n)};return window.addEventListener("keydown",n),window.addEventListener("keyup",t),window.addEventListener("keypress",s),()=>{window.removeEventListener("keydown",n),window.removeEventListener("keyup",t),window.removeEventListener("keypress",s)}},[O,D]),(0,a.useEffect)(()=>{O&&(null==O||O.onLoaded({apiVersion:v.uL}),r(!0))},[O]),(0,a.useLayoutEffect)(()=>{if(e){if(Z&&t&&c&&!T&&!_.current){var n;null===(n=L.current)||void 0===n||n.focus()}_.current=Z}},[Z,e]);let K=()=>{I([]),C(void 0),M(null)},H=async e=>{var n;return null!==(n=null==O?void 0:O.openInEditor(e))&&void 0!==n&&n},q=async e=>null==O?void 0:O.openExternal(e),W=async()=>{var e;return null!==(e=null==O?void 0:O.getActiveEditorSelection())&&void 0!==e?e:null},J=async()=>{var e,n;return null!==(n=null==O?void 0:null===(e=O.fetchSessionState)||void 0===e?void 0:e.call(O))&&void 0!==n?n:null},$=async e=>{var n;return null==O?void 0:null===(n=O.storeSessionState)||void 0===n?void 0:n.call(O,e)},B=async()=>{A(!0),await (null==O?void 0:O.refresh()),A(!1)};function G(e){let{children:n}=e;return(0,s.jsxs)("div",{className:"h-screen w-screen",style:{padding:"intellij"==D?"20px":"5px 18px"},children:[(0,s.jsxs)("div",{className:"flex items-center",style:{marginBottom:"0.55em"},children:[(0,s.jsx)(l(),{src:o.Z,alt:"logo",className:"rounded-full",style:{background:"rgb(232, 226, 210)",marginRight:"0.375em",padding:"0.15em"},width:18}),(0,s.jsx)("p",{className:"font-semibold",children:"Tabby"})]}),n]})}if(T)return(0,s.jsx)(G,{children:(0,s.jsxs)(s.Fragment,{children:[T.title&&(0,s.jsx)("p",{className:"mb-1.5 mt-2 font-semibold",children:T.title}),(0,s.jsx)(eG.s,{className:"prose max-w-none break-words dark:prose-invert prose-p:leading-relaxed prose-pre:mt-1 prose-pre:p-0",remarkPlugins:[h.Z,f.Z],children:T.content}),(0,s.jsxs)(x.z,{className:"mt-5 flex items-center gap-x-2 text-sm leading-none",onClick:B,children:[R&&(0,s.jsx)(g.IconSpinner,{}),"Refresh"]})]})});if(!t||!c)return(0,s.jsx)(G,{children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"opacity-80",children:"Welcome to Tabby Chat! Just a moment while we get things ready..."}),(0,s.jsx)(g.IconSpinner,{className:"mx-auto",style:{marginTop:"1.25em",width:"0.875em",height:"0.875em"}})]})});let Q=(null==O?void 0:O.storeSessionState)&&(null==O?void 0:O.fetchSessionState);return(0,s.jsxs)(m.SV,{FallbackComponent:function(e){let{error:n}=e;return(0,s.jsxs)(G,{children:[(0,s.jsx)("p",{className:"mb-1.5 mt-2 font-semibold",children:"Something went wrong"}),(0,s.jsx)("p",{children:n.message}),(0,s.jsxs)(x.z,{className:"mt-5 flex items-center gap-x-2 text-sm leading-none",onClick:B,children:[R&&(0,s.jsx)(g.IconSpinner,{}),"Refresh"]})]})},children:[j&&(0,s.jsx)(eX,{onClose:()=>y(!1),onNavigate:e=>N(e)}),(0,s.jsx)(eB,{style:{display:j?"none":"block"},threadId:b,setThreadId:N,ref:L,chatInputRef:U,onLoaded:()=>{let e=L.current;e&&(k.forEach(n=>{e.addRelevantContext(n)}),S&&e.updateActiveSelection(S),w&&e.executeCommand(w),K(),n(!0))},setShowHistory:y,onCopyContent:z&&(null==O?void 0:O.onCopy),onApplyInEditor:z&&((null==O?void 0:O.onApplyInEditorV2)?null==O?void 0:O.onApplyInEditorV2:null==O?void 0:O.onApplyInEditor),supportsOnApplyInEditorV2:!!(null==O?void 0:O.onApplyInEditorV2),onLookupSymbol:z&&(null==O?void 0:O.lookupSymbol),openInEditor:H,openExternal:q,readWorkspaceGitRepositories:null==O?void 0:O.readWorkspaceGitRepositories,getActiveEditorSelection:W,fetchSessionState:Q?J:void 0,storeSessionState:Q?$:void 0,listFileInWorkspace:z&&(null==O?void 0:O.listFileInWorkspace),readFileContent:z&&(null==O?void 0:O.readFileContent),listSymbols:z&&(null==O?void 0:O.listSymbols)})]})}},17448:function(e,n,t){"use strict";t.d(n,{p:function(){return a}});var s=t(3546);let a=(0,s.createContext)({})},74787:function(e,n,t){"use strict";t.d(n,{Gn:function(){return o},HV:function(){return c},_t:function(){return u},jZ:function(){return m},xe:function(){return d}});var s=t(36164),a=t(31745),r=t(74038),l=t(57288),i=t(81565);function o(e){let n=(0,l.eo)(e.filepath).filepath,t={fileItem:e,name:(0,l.UA)(n),filepath:n,category:"file",icon:(0,s.jsx)(i.IconFile,{})};try{return{id:JSON.stringify(e.filepath),...t}}catch(e){return{id:(0,l.x0)(),...t}}}function d(e){let n=(0,l.eo)(e.filepath).filepath;return{category:"symbol",id:e.label,name:e.label,filepath:n,fileItem:e,icon:(0,s.jsx)(a.Z,{className:"h-4 w-4"})}}function c(e){let n,t=e;for(;null!==(n=r.My.exec(e));)try{let e=n[1],s=JSON.parse(e),a="filepath"in s?s.filepath:s.uri,r=(0,l.UA)(a);t=t.replace(n[0],"@".concat(r))}catch(e){continue}return t}function u(e){let n=[],t=0;return e.replace(r.My,(s,a,r)=>{r>t&&n.push({type:"text",text:e.slice(t,r)});try{n.push({type:"mention",attrs:{category:"file",fileItem:{filepath:JSON.parse(a)}}})}catch(e){}return t=r+s.length,s}),t<e.length&&n.push({type:"text",text:e.slice(t)}),n}let m=(e,n)=>{var t,s,a,r;let l=e.filepath===n.filepath&&e.baseDir===n.baseDir&&e.gitUrl===n.gitUrl;return e.range||n.range?l&&(null===(t=e.range)||void 0===t?void 0:t.start)===(null===(s=n.range)||void 0===s?void 0:s.start)&&(null===(a=e.range)||void 0===a?void 0:a.end)===(null===(r=n.range)||void 0===r?void 0:r.end):l}},54173:function(e,n,t){"use strict";t.d(n,{d:function(){return o}});var s=t(36164),a=t(3546),r=t(76297),l=t(57288);let i=e=>{let{onLoad:n,isFetching:t,children:i,className:o,intersectionOptions:d}=e,{ref:c,inView:u}=(0,r.YD)(d);return a.useEffect(()=>{u&&!t&&(null==n||n())},[u]),(0,s.jsx)("div",{className:(0,l.cn)("w-full",o),ref:c,children:null!=i?i:(0,s.jsx)("div",{children:"loading..."})})},o=e=>(0,s.jsx)(i,{...e})},6230:function(e,n,t){"use strict";var s=t(36164),a=t(3546),r=t(24449),l=t(90379);n.Z=e=>{let{triggerOnce:n=!0,loading:t,fallback:i,delay:o,children:d}=e,[c,u]=a.useState(!t),[m]=(0,r.n)(c,null!=o?o:200);return(a.useEffect(()=>{n?t||c||u(!0):u(!t)},[t]),m)?d:i||(0,s.jsx)(l.cg,{})}},73033:function(e,n,t){"use strict";t.d(n,{s:function(){return l}});var s=t(36164),a=t(3546),r=t(52991);let l=(0,a.memo)(e=>(0,s.jsx)(r.D,{linkTarget:"_blank",...e}),(e,n)=>e.children===n.children&&e.className===n.className)},37034:function(e,n,t){"use strict";t.d(n,{k:function(){return l}});var s=t(36164),a=t(18500),r=t(81565);function l(e){let{kind:n,gitIcon:t,...l}=e;switch(n){case a.ri.Doc:return(0,s.jsx)(r.IconEmojiBook,{...l});case a.ri.Web:return(0,s.jsx)(r.IconEmojiGlobe,{...l});case a.ri.Github:return(0,s.jsx)(r.IconGitHub,{...l});case a.ri.Gitlab:return(0,s.jsx)(r.IconGitLab,{...l});case a.ri.Git:return t||(0,s.jsx)(r.IconCode,{...l});default:return null}}},70834:function(e,n,t){"use strict";t.d(n,{q:function(){return c}});var s=t(36164),a=t(57288),r=t(62202),l=t(6230),i=t(31458),o=t(81565),d=t(3448);function c(e){let{models:n,value:t,onChange:c,isInitializing:u,triggerClassName:m}=e,h=e=>{c(e)};return(0,s.jsx)(l.Z,{loading:u,fallback:(0,s.jsx)("div",{className:"w-full pl-2",children:(0,s.jsx)(d.O,{className:"h-3 w-[20%]"})}),children:!!(null==n?void 0:n.length)&&(0,s.jsxs)(r.h_,{children:[(0,s.jsx)(r.$F,{asChild:!0,children:(0,s.jsxs)(i.z,{variant:"ghost",className:(0,a.cn)("gap-2 px-1.5 py-1 text-foreground/90",m),children:[(0,s.jsx)(o.IconBox,{}),t]})}),(0,s.jsx)(r.AW,{side:"bottom",align:"start",className:"dropdown-menu max-h-[30vh] min-w-[20rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-2 text-popover-foreground shadow animate-in",children:(0,s.jsx)(r._x,{value:t,onValueChange:c,children:n.map(e=>{let n=e===t;return(0,s.jsxs)(r.qB,{onClick:n=>{h(e),n.stopPropagation()},value:e,className:"cursor-pointer py-2 pl-3",children:[(0,s.jsx)(o.IconCheck,{className:(0,a.cn)("mr-2 shrink-0",e===t?"opacity-100":"opacity-0")}),(0,s.jsx)("span",{className:(0,a.cn)({"font-medium":n}),children:e})]},e)})})})]})})}},65858:function(e,n,t){"use strict";t.d(n,{Qd:function(){return d},UQ:function(){return o},o4:function(){return c},vF:function(){return u}});var s=t(36164),a=t(3546),r=t(43739),l=t(14079),i=t(57288);let o=r.fC,d=a.forwardRef((e,n)=>{let{className:t,...a}=e;return(0,s.jsx)(r.ck,{ref:n,className:(0,i.cn)("border-b",t),...a})});d.displayName="AccordionItem";let c=a.forwardRef((e,n)=>{let{className:t,children:a,showChevron:o=!0,...d}=e;return(0,s.jsxs)(r.xz,{ref:n,className:(0,i.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",t),...d,children:[a,o&&(0,s.jsx)(l.Z,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})});c.displayName=r.xz.displayName;let u=a.forwardRef((e,n)=>{let{className:t,children:a,...l}=e;return(0,s.jsx)(r.VY,{ref:n,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...l,children:(0,s.jsx)("div",{className:(0,i.cn)("pb-4 pt-0",t),children:a})})});u.displayName=r.VY.displayName},62202:function(e,n,t){"use strict";t.d(n,{$F:function(){return o},AW:function(){return u},Ju:function(){return f},VD:function(){return v},Xi:function(){return m},_x:function(){return d},h_:function(){return i},qB:function(){return h}});var s=t(36164),a=t(3546),r=t(19148),l=t(57288);let i=r.fC,o=r.xz;r.ZA,r.Uv,r.Tr;let d=r.Ee;r.wU;let c=a.forwardRef((e,n)=>{let{className:t,...a}=e;return(0,s.jsx)(r.tu,{ref:n,className:(0,l.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in data-[side=bottom]:slide-in-from-top-1 data-[side=left]:slide-in-from-right-1 data-[side=right]:slide-in-from-left-1 data-[side=top]:slide-in-from-bottom-1",t),...a})});c.displayName=r.tu.displayName;let u=a.forwardRef((e,n)=>{let{className:t,sideOffset:a=4,...i}=e;return(0,s.jsx)(r.Uv,{children:(0,s.jsx)(r.VY,{ref:n,sideOffset:a,className:(0,l.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow animate-in data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...i})})});u.displayName=r.VY.displayName;let m=a.forwardRef((e,n)=>{let{className:t,inset:a,...i}=e;return(0,s.jsx)(r.ck,{ref:n,className:(0,l.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a&&"pl-8",t),...i})});m.displayName=r.ck.displayName;let h=a.forwardRef((e,n)=>{let{className:t,inset:a,...i}=e;return(0,s.jsx)(r.Rk,{ref:n,className:(0,l.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a&&"pl-8",t),...i})});h.displayName=r.Rk.displayName;let f=a.forwardRef((e,n)=>{let{className:t,inset:a,...i}=e;return(0,s.jsx)(r.__,{ref:n,className:(0,l.cn)("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",t),...i})});f.displayName=r.__.displayName;let v=a.forwardRef((e,n)=>{let{className:t,...a}=e;return(0,s.jsx)(r.Z0,{ref:n,className:(0,l.cn)("-mx-1 my-1 h-px bg-muted",t),...a})});v.displayName=r.Z0.displayName},52569:function(e,n,t){"use strict";t.d(n,{SQ:function(){return b},Yt:function(){return y},nY:function(){return j}});var s=t(36164),a=t(3546),r=t(87782),l=t(21454),i=t(36327),o=t(98454),d=t(3765),c=t(57288),u=t(66612);let m=a.forwardRef((e,n)=>{let{className:t,...a}=e;return(0,s.jsx)(u.fC,{ref:n,className:(0,c.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...a})});m.displayName=u.fC.displayName;let h=a.forwardRef((e,n)=>{let{className:t,...a}=e;return(0,s.jsx)(u.Ee,{ref:n,className:(0,c.cn)("aspect-square h-full w-full",t),...a})});h.displayName=u.Ee.displayName;let f=a.forwardRef((e,n)=>{let{className:t,...a}=e;return(0,s.jsx)(u.NY,{ref:n,className:(0,c.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...a})});f.displayName=u.NY.displayName;var v=t(3448),p=t(30410).lW;let x="not_found",g=new Set,j=e=>{g.delete(e),(0,l.JG)("/avatar/".concat(e))};function y(e){var n;let{user:t,className:l,fallback:o}=e,u=null==t?void 0:t.id,j=u?"/avatar/".concat(u):null,{data:y,isLoading:b,error:N}=(0,i.Z)(j,e=>{if(!(!u||g.has(u)))return(0,d.Z)(e,{responseFormatter:async e=>{let n=await e.blob(),t=p.from(await n.arrayBuffer());return"data:image/png;base64,".concat(t.toString("base64"))},errorHandler:e=>{if(404===e.status)throw Error(x)}})}),w=a.useMemo(()=>{if(null==t?void 0:t.email)return(0,r.B)(t.email)},[null==t?void 0:t.email]);return b?(0,s.jsx)(v.O,{className:(0,c.cn)("h-16 w-16 rounded-full",l)}):((null==N?void 0:N.message)===x&&u&&g.add(u),y||w||!o)?!y&&w?(0,s.jsx)(r.Z,{className:(0,c.cn)("h-16 w-16",l),...w}):(0,s.jsxs)(m,{className:(0,c.cn)("h-16 w-16",l),children:[(0,s.jsx)(h,{src:y,alt:null==t?void 0:t.email,className:"object-cover"}),(0,s.jsx)(f,{children:null==t?void 0:null===(n=t.email)||void 0===n?void 0:n.substring(0,2)})]}):o}function b(e){let[{data:n}]=(0,o.P)();return(0,s.jsx)(y,{user:null==n?void 0:n.me,...e})}},31159:function(e,n,t){"use strict";t.d(n,{Vq:function(){return o}});var s=t(3546),a=t(21454),r=t(27257),l=t(3765),i=t(17451);function o(){let{data:e,isLoading:n}=(0,a.ZP)("/v1beta/models",e=>(0,l.Z)(e,{errorHandler:()=>{throw Error("Fetch supported model failed.")}}),{shouldRetryOnError:!1}),t=(0,r.oR)(i.aK,e=>e.selectedModel);return(0,s.useEffect)(()=>{if(!n){let n=function(e,n){if(!(null==n?void 0:n.length))return;let t=!!e&&n.includes(e);return t?e:n[0]}(t,null==e?void 0:e.chat);(0,i.Eg)(n)}},[n]),{isFetchingModels:n,selectedModel:t,models:null==e?void 0:e.chat}}},64566:function(e,n,t){"use strict";t.d(n,{x:function(){return u}});var s=t(3546),a=t(43240),r=t(11634),l=t(16784);let i=(0,a.BX)("\n  subscription CreateThreadAndRun($input: CreateThreadAndRunInput!) {\n    createThreadAndRun(input: $input) {\n      __typename\n      ... on ThreadCreated {\n        id\n      }\n      ... on ThreadUserMessageCreated {\n        id\n      }\n      ... on ThreadAssistantMessageCreated {\n        id\n      }\n      ... on ThreadAssistantMessageReadingCode {\n        snippet\n        fileList\n      }\n      ... on ThreadRelevantQuestions {\n        questions\n      }\n      ... on ThreadAssistantMessageAttachmentsCodeFileList {\n        codeFileList: fileList\n        truncated\n      }\n      ... on ThreadAssistantMessageAttachmentsCode {\n        hits {\n          code {\n            gitUrl\n            commit\n            filepath\n            language\n            content\n            startLine\n          }\n          scores {\n            rrf\n            bm25\n            embedding\n          }\n        }\n      }\n      ... on ThreadAssistantMessageAttachmentsDoc {\n        hits {\n          doc {\n            __typename\n            ... on MessageAttachmentWebDoc {\n              title\n              link\n              content\n            }\n            ... on MessageAttachmentIssueDoc {\n              title\n              link\n              author {\n                id\n                email\n                name\n              }\n              body\n              closed\n            }\n            ... on MessageAttachmentPullDoc {\n              title\n              link\n              author {\n                id\n                email\n                name\n              }\n              body\n              merged\n            }\n            ... on MessageAttachmentCommitDoc {\n              sha\n              message\n              author {\n                id\n                email\n                name\n              }\n              authorAt\n            }\n          }\n          score\n        }\n      }\n      ... on ThreadAssistantMessageContentDelta {\n        delta\n      }\n      ... on ThreadAssistantMessageCompleted {\n        id\n      }\n    }\n  }\n"),o=(0,a.BX)("\n  subscription CreateThreadRun($input: CreateThreadRunInput!) {\n    createThreadRun(input: $input) {\n      __typename\n      ... on ThreadCreated {\n        id\n      }\n      ... on ThreadUserMessageCreated {\n        id\n      }\n      ... on ThreadAssistantMessageCreated {\n        id\n      }\n      ... on ThreadAssistantMessageReadingCode {\n        snippet\n        fileList\n      }\n      ... on ThreadRelevantQuestions {\n        questions\n      }\n      ... on ThreadAssistantMessageAttachmentsCodeFileList {\n        codeFileList: fileList\n        truncated\n      }\n      ... on ThreadAssistantMessageAttachmentsCode {\n        hits {\n          code {\n            gitUrl\n            commit\n            filepath\n            language\n            content\n            startLine\n          }\n          scores {\n            rrf\n            bm25\n            embedding\n          }\n        }\n      }\n      ... on ThreadAssistantMessageAttachmentsDoc {\n        hits {\n          doc {\n            __typename\n            ... on MessageAttachmentWebDoc {\n              title\n              link\n              content\n            }\n            ... on MessageAttachmentIssueDoc {\n              title\n              link\n              author {\n                id\n                email\n                name\n              }\n              body\n              closed\n            }\n            ... on MessageAttachmentPullDoc {\n              title\n              link\n              author {\n                id\n                email\n                name\n              }\n              body\n              merged\n            }\n            ... on MessageAttachmentCommitDoc {\n              sha\n              message\n              author {\n                id\n                email\n                name\n              }\n              authorAt\n            }\n          }\n          score\n        }\n      }\n      ... on ThreadAssistantMessageContentDelta {\n        delta\n      }\n      ... on ThreadAssistantMessageCompleted {\n        id\n      }\n    }\n  }\n"),d=(0,a.BX)("\n  mutation DeleteThreadMessagePair(\n    $threadId: ID!\n    $userMessageId: ID!\n    $assistantMessageId: ID!\n  ) {\n    deleteThreadMessagePair(\n      threadId: $threadId\n      userMessageId: $userMessageId\n      assistantMessageId: $assistantMessageId\n    )\n  }\n"),c=()=>({content:"",completed:!1,isReadingCode:!1,isReadingFileList:!1,isReadingDocs:!0});function u(e){let{threadId:n,onAssistantMessageCompleted:t}=e,[a,u]=s.useState(n),m=s.useRef(),[h,f]=s.useState(!1),[v,p]=s.useState(c()),[x,g]=s.useState(),j=(e,n)=>{let t={...e};switch(n.__typename){case"ThreadCreated":t.threadId=n.id;break;case"ThreadUserMessageCreated":t.userMessageId=n.id;break;case"ThreadAssistantMessageCreated":t.assistantMessageId=n.id;break;case"ThreadRelevantQuestions":t.relevantQuestions=n.questions;break;case"ThreadAssistantMessageReadingCode":t.isReadingCode=!0,t.isReadingFileList=!0,t.isReadingDocs=!0,t.readingCode={fileList:n.fileList,snippet:n.snippet};break;case"ThreadAssistantMessageAttachmentsCodeFileList":t.isReadingFileList=!1,t.attachmentsFileList=n;break;case"ThreadAssistantMessageAttachmentsCode":t.isReadingCode=!1,t.attachmentsCode=n.hits;break;case"ThreadAssistantMessageAttachmentsDoc":t.attachmentsDoc=n.hits,t.isReadingDocs=!1;break;case"ThreadAssistantMessageContentDelta":t.isReadingCode=!1,t.isReadingFileList=!1,t.isReadingDocs=!1,t.content+=n.delta;break;case"ThreadAssistantMessageCompleted":t.completed=!0}return t},y=(0,l.d)(e=>{var n;null===(n=m.current)||void 0===n||n.call(m),m.current=void 0,f(!1),p(e=>({...e,isReadingCode:!1,isReadingFileList:!1,isReadingDocs:!1,completed:!0})),!e&&a&&(null==t||t(v))});s.useEffect(()=>{n!==a&&u(n)},[n]);let b=(e,n)=>{let{unsubscribe:t}=r.Lp.subscription(i,{input:{thread:{userMessage:e},options:n}}).subscribe(e=>{var n;if(null==e?void 0:e.error){f(!1),g(e.error),t();return}let s=null===(n=e.data)||void 0===n?void 0:n.createThreadAndRun;s&&((null==s?void 0:s.__typename)==="ThreadAssistantMessageCompleted"&&y.current(),(null==s?void 0:s.__typename)==="ThreadCreated"&&s.id!==a&&u(s.id),p(e=>j(e,s)))});return t},N=(e,n)=>{if(!a)return;let{unsubscribe:t}=r.Lp.subscription(o,{input:{threadId:a,additionalUserMessage:e,options:n}}).subscribe(e=>{var n;if(null==e?void 0:e.error){f(!1),g(e.error),t();return}let s=null===(n=e.data)||void 0===n?void 0:n.createThreadRun;s&&("ThreadAssistantMessageCompleted"===s.__typename&&y.current(),p(e=>j(e,s)))});return t},w=(0,r.Db)(d),C=(e,n)=>{h||(f(!0),g(void 0),p(c()),a?m.current=N(e,n):m.current=b(e,n))},k=(e,n,t)=>w({threadId:e,userMessageId:n,assistantMessageId:t}).then(e=>{var n;if(!(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.deleteThreadMessagePair)){if(null==e?void 0:e.error)throw e.error;throw Error("Failed to fetch")}});return{isLoading:h,answer:v,error:x,sendUserMessage:C,stop:y.current,regenerate:e=>a?(f(!0),g(void 0),p(c()),k(e.threadId,e.userMessageId,e.assistantMessageId).then(()=>{C(e.userMessage,e.threadRunOptions)}).catch(e=>{let n=e instanceof Error?e:Error("Failed to fetch");g(n),f(!1)})):Promise.resolve(void 0),deleteThreadMessagePair:k}}},2596:function(){},67325:function(){}},function(e){e.O(0,[7565,8415,4648,6527,7430,8516,1652,340,2546,1283,3449,2578,8511,4421,7070,1454,1002,4546,6805,9275,9148,6482,2991,7581,5738,2812,8160,9294,8483,7288,1565,4656,4129,2128,3375,5289,1744],function(){return e(e.s=14454)}),_N_E=e.O()}]);