(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2797],{46576:function(e,n,t){Promise.resolve().then(t.bind(t,13255))},13255:function(e,n,t){"use strict";t.r(n),t.d(n,{SOURCE_CARD_STYLE:function(){return ez},Search:function(){return eE}});var s=t(36164),a=t(3546),l=t(70652),i=t.n(l),r=t(11978),o=t(54767),d=t(1853),c=t(82030),u=t(66035),m=t(52807),h=t(12978),x=t(56575),f=t(2578),p=t(40055),v=t(21808),g=t(93877),j=t(43240),b=t(18500),N=t(28312),w=t(9010),C=t(16784),y=t(98454),I=t(31159),k=t(4951),R=t(44645),M=t(80605),S=t(64566),A=t(17451),L=t(96274),D=t(37266),T=t(11634),F=t(70410),z=t(73492),_=t(31458),U=t(81565),E=t(53538),O=t(57830),P=t(11208),Z=t(29),Q=t(72657),q=t(30601),V=t(94779),$=t(6230),B=t(69579),Y=t(30087),G=t(84381),X=t(94909),H=t(5493),K=t(23455),W=t(23782),J=t(74038),ee=t(98150),en=t(3448),et=t(17448),es=t(48537),ea=t(22507),el=t(65858),ei=t(90615),er=t(25600),eo=t(21008),ed=t(64219),ec=t(37034);function eu(e){let{isLoading:n,children:t,title:l,defaultOpen:i,isLastItem:r}=e,o="item",[d,c]=(0,a.useState)(!!i),u=!!t;return(0,a.useEffect)(()=>{u&&!d&&c(!0)},[u]),(0,s.jsx)("div",{children:(0,s.jsx)(el.UQ,{type:"single",value:d?o:"",collapsible:u,className:"z-10",onValueChange:e=>{c(e===o)},children:(0,s.jsxs)(el.Qd,{value:o,className:"relative border-0",children:[(!r||d&&u)&&(0,s.jsx)("div",{className:"absolute left-2 top-5 block h-full w-0.5 shrink-0 translate-x-px rounded-full bg-muted"}),(0,s.jsx)(el.o4,{className:"group w-full gap-2 rounded-lg py-1 pl-0.5 pr-2 !no-underline hover:bg-muted/70",showChevron:!!t,children:(0,s.jsxs)("div",{className:"flex flex-1 items-center gap-4",children:[(0,s.jsx)("div",{className:"relative z-10 shrink-0 bg-background group-hover:bg-muted/70",children:n?(0,s.jsx)(U.IconSpinner,{}):(0,s.jsx)(U.IconCheckFull,{className:"h-4 w-4"})}),(0,s.jsx)("span",{children:l})]})}),!!t&&(0,s.jsx)(el.vF,{className:"pb-0 pl-9",children:t})]})})})}let em=(0,a.createContext)({});function eh(e){var n,t;let{docQuery:l,isReadingCode:i,isReadingFileList:r,isReadingDocs:o,readingCode:d,codeSourceId:c,serverCodeContexts:u,clientCodeContexts:m,docs:h,codeFileList:x,onContextClick:f}=e,{contextInfo:p,enableDeveloperMode:v}=(0,a.useContext)(em),g=((null==m?void 0:m.length)||0)+u.length+((null==h?void 0:h.length)||0),j=(0,a.useMemo)(()=>{if(!c)return;let e=null==p?void 0:p.sources.find(e=>(0,z.wO)(e.sourceKind)&&e.sourceId===c);return e},[c,p]),b=(0,a.useMemo)(()=>{let e=[];return(null==d?void 0:d.fileList)&&e.push("fileList"),(null==d?void 0:d.snippet)&&e.push("snippet"),l&&e.push("docs"),e},[null==d?void 0:d.fileList,null==d?void 0:d.snippet,l]),N=(0,a.useMemo)(()=>b.slice().pop(),[b]);return(0,s.jsx)(el.UQ,{collapsible:!0,type:"single",defaultValue:"readingCode",children:(0,s.jsxs)(el.Qd,{value:"readingCode",className:"border-0",children:[(0,s.jsx)(el.o4,{className:"w-full py-2 pr-2",children:(0,s.jsxs)("div",{className:"flex flex-1 items-center justify-between pr-2",children:[(0,s.jsxs)("div",{className:"flex flex-1 items-center gap-2",children:[(0,s.jsx)(U.IconCode,{className:"mr-2 h-5 w-5 shrink-0"}),(0,s.jsx)("span",{children:"Look into"}),!!j&&(0,s.jsxs)("div",{className:"inline-flex cursor-pointer items-center gap-0.5 font-medium",children:[(0,s.jsx)(ec.k,{kind:j.sourceKind,className:"h-3.5 w-3.5 shrink-0"}),(0,s.jsx)("span",{className:"truncate",children:j.sourceName})]})]}),(0,s.jsx)("div",{children:g?(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:[g," sources"]}):null})]})}),(0,s.jsx)(el.vF,{className:"pb-0",children:(0,s.jsxs)("div",{className:"space-y-2 text-sm text-muted-foreground",children:[(null==d?void 0:d.fileList)&&(0,s.jsx)(eu,{title:"Read codebase structure ...",isLoading:r,isLastItem:"fileList"===N,defaultOpen:!!(null==x?void 0:null===(n=x.fileList)||void 0===n?void 0:n.length),children:(null==x?void 0:null===(t=x.fileList)||void 0===t?void 0:t.length)?(0,s.jsxs)(er.yo,{children:[(0,s.jsx)(er.aM,{children:(0,s.jsxs)("div",{className:"mb-3 mt-2 flex cursor-pointer flex-nowrap items-center gap-0.5 rounded-md bg-muted px-1.5 py-0.5 text-xs font-semibold hover:text-foreground",children:[(0,s.jsx)(U.IconListTree,{className:"h-3 w-3"}),(0,s.jsxs)("span",{children:[x.fileList.length," items"]})]})}),(0,s.jsxs)(er.ue,{className:"flex w-[50vw] min-w-[300px] flex-col gap-0 px-4 pb-0",children:[(0,s.jsxs)(er.Tu,{className:"border-b",children:[(0,s.jsxs)(er.bC,{children:[x.fileList.length," items"]}),(0,s.jsx)(er.sw,{})]}),(0,s.jsx)("pre",{className:"flex-1 overflow-auto py-3",children:x.fileList.join("\n")}),x.truncated&&(0,s.jsx)(er.FF,{className:"!justify-start border-t py-3 font-medium",children:"File list truncated. (Maximum number of items has been reached)"})]})]}):null},"fileList"),(null==d?void 0:d.snippet)&&(0,s.jsx)(eu,{title:"Search for relevant code snippets ...",isLoading:i,defaultOpen:!!(null==m?void 0:m.length)||!!(null==u?void 0:u.length),isLastItem:"snippet"===N,children:(!!(null==m?void 0:m.length)||!!(null==u?void 0:u.length))&&(0,s.jsx)("div",{className:"mb-3 mt-2",children:(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 text-xs font-semibold",children:[null==m?void 0:m.map((e,n)=>(0,s.jsx)(ex,{context:e,clickable:!1,onContextClick:e=>null==f?void 0:f(e,!0),enableDeveloperMode:v},"client-".concat(n))),null==u?void 0:u.map((e,n)=>(0,s.jsx)(ex,{context:e,onContextClick:e=>null==f?void 0:f(e,!0),enableDeveloperMode:v},"server-".concat(n)))]})})},"snippet"),l&&(0,s.jsx)(eu,{title:"Collect documents ...",isLastItem:"docs"===N,isLoading:o,defaultOpen:!!(null==h?void 0:h.length),children:!!(null==h?void 0:h.length)&&(0,s.jsx)("div",{className:"mb-3 mt-2 space-y-1",children:(0,s.jsx)("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:null==h?void 0:h.map((e,n)=>{let t=(0,z.j9)(e)?e.sha:e.link;return(0,s.jsx)("div",{children:(0,s.jsxs)(ei.zs,{openDelay:100,closeDelay:100,children:[(0,s.jsx)(ei.Yi,{children:(0,s.jsx)(ef,{doc:e})}),(0,s.jsx)(ei.bZ,{className:"w-96 bg-background text-sm text-foreground dark:border-muted-foreground/60",children:(0,s.jsx)(ed.Z,{enableDeveloperMode:v,relevantDocument:e,onLinkClick:e=>{window.open(e)}})})]})},"".concat(t,"_").concat(n))})})})},"docs")]})})]})})}function ex(e){var n,t,l,i,r;let{context:o,clickable:d=!0,onContextClick:c,enableDeveloperMode:u}=e,m=(0,z.Cn)(o.filepath),h=(0,a.useMemo)(()=>(0,z.UA)(o.filepath),[o.filepath]),x=null==o?void 0:null===(n=o.extra)||void 0===n?void 0:n.scores;return(0,s.jsxs)(Z.u,{delayDuration:100,children:[(0,s.jsx)(Z.aJ,{asChild:!0,children:(0,s.jsxs)("div",{className:(0,z.cn)("group flex flex-nowrap items-center gap-0.5 rounded-md bg-muted px-1.5 py-0.5",{"cursor-pointer hover:text-foreground":d}),onClick:e=>{d&&(null==c||c(o))},children:[(0,s.jsx)(U.IconFileText,{className:"h-3 w-3"}),(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{children:h}),(0,s.jsx)(eo.o,{className:(0,z.cn)("font-normal text-muted-foreground",{"group-hover:text-foreground":d}),range:o.range})]})]})}),(0,s.jsx)(Z._v,{align:"start",sideOffset:8,className:"max-w-[24rem]",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"whitespace-nowrap font-medium",children:[(0,s.jsx)("span",{children:h}),(0,s.jsx)(eo.o,{range:o.range})]}),!!m&&(0,s.jsx)("div",{className:"break-all text-xs text-muted-foreground",children:m}),u&&(null==o?void 0:null===(t=o.extra)||void 0===t?void 0:t.scores)&&(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("div",{className:"mb-1 font-semibold",children:"Scores"}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("span",{className:"w-20",children:"rrf:"}),null!==(l=null==x?void 0:x.rrf)&&void 0!==l?l:"-"]}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("span",{className:"w-20",children:"bm25:"}),null!==(i=null==x?void 0:x.bm25)&&void 0!==i?i:"-"]}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("span",{className:"w-20",children:"embedding:"}),null!==(r=null==x?void 0:x.embedding)&&void 0!==r?r:"-"]})]})]})]})})]})}function ef(e){let{doc:n}=e,t=(0,z.Jd)(n),a=(0,z.XK)(n),l=(0,z.j9)(n),i=l?"".concat(n.sha.slice(0,7)):"#".concat(n.link.split("/").pop()),r=l?void 0:n.link,o=null;return t&&(o=n.closed?(0,s.jsx)(U.IconCheckCircled,{className:"h-3 w-3"}):(0,s.jsx)(U.IconCircleDot,{className:"h-3 w-3"})),a&&(o=n.merged?(0,s.jsx)(U.IconGitMerge,{className:"h-3 w-3"}):(0,s.jsx)(U.IconGitPullRequest,{className:"h-3 w-3"})),l&&(o=(0,s.jsx)(U.IconGitCommit,{className:"h-3 w-3"})),(0,s.jsxs)("div",{className:(0,z.cn)("flex flex-nowrap items-center gap-0.5 rounded-md bg-muted px-1.5 py-0.5 font-semibold hover:text-foreground",{"cursor-pointer":!!r}),onClick:()=>{r&&window.open(r)},children:[o,(0,s.jsx)("span",{children:i})]})}var ep=t(89811);function ev(e){var n,t;let{isReadingDocs:l,webDocs:i,docQuerySources:r,pages:o}=e,{enableDeveloperMode:d}=(0,a.useContext)(em),c=!!r&&r.filter(e=>e.sourceKind!==b.ri.Page).length>0,u=null!==(n=null==i?void 0:i.length)&&void 0!==n?n:0,m=null!==(t=null==o?void 0:o.length)&&void 0!==t?t:0,h=u+m;return(0,s.jsx)(el.UQ,{collapsible:!0,type:"single",defaultValue:"readingCode",children:(0,s.jsxs)(el.Qd,{value:"readingCode",className:"border-0",children:[(0,s.jsx)(el.o4,{className:"w-full py-2 pr-2",children:(0,s.jsxs)("div",{className:"flex flex-1 items-center justify-between pr-2",children:[(0,s.jsxs)("div",{className:"flex flex-1 items-center gap-2",children:[(0,s.jsx)(U.IconBlocks,{className:"mr-2 h-5 w-5 shrink-0"}),(0,s.jsx)("span",{className:"shrink-0",children:"Look into"}),(0,s.jsx)("div",{className:"flex flex-1 flex-nowrap gap-2 truncate",children:null==r?void 0:r.map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-1 rounded-lg border px-2 py-0 text-sm font-medium no-underline",children:[e.sourceKind===b.ri.Web?(0,s.jsx)(U.IconEmojiGlobe,{className:"h-3 w-3 shrink-0",emojiClassName:"text-sm"}):e.sourceKind===b.ri.Page?(0,s.jsx)(U.IconBookOpen,{className:"h-3.5 w-3.5 shrink-0"}):(0,s.jsx)(U.IconEmojiBook,{className:"h-3 w-3 shrink-0",emojiClassName:"text-sm"}),e.sourceName]},e.sourceId))})]}),(0,s.jsx)("div",{className:"shrink-0",children:h?(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:[h," sources"]}):null})]})}),(0,s.jsx)(el.vF,{className:"pb-0",children:(0,s.jsxs)("div",{className:"space-y-2 text-sm text-muted-foreground",children:[(0,s.jsx)(eu,{title:"Search pages ...",isLoading:l,defaultOpen:!!m,isLastItem:!c,children:!!(null==o?void 0:o.length)&&(0,s.jsx)("div",{className:"mb-3 mt-2",children:(0,s.jsx)("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:o.map((e,n)=>{let t=(0,z.j9)(e)?e.sha:e.link;return(0,s.jsx)("div",{children:(0,s.jsxs)(ei.zs,{openDelay:100,closeDelay:100,children:[(0,s.jsx)(ei.Yi,{children:(0,s.jsx)("div",{className:"group cursor-pointer whitespace-nowrap rounded-md bg-muted px-1.5 py-0.5 font-semibold",onClick:()=>window.open(t),children:(0,s.jsx)(ej,{doc:e})})}),(0,s.jsx)(ei.bZ,{className:"w-96 bg-background text-sm text-foreground dark:border-muted-foreground/60",children:(0,s.jsx)(ed.Z,{enableDeveloperMode:d,relevantDocument:e,onLinkClick:e=>{window.open(e)}})})]})},"".concat(t,"_").concat(n))})})})}),c&&(0,s.jsx)(eu,{title:"Collect documents ...",isLastItem:!0,isLoading:l,defaultOpen:!!u,children:!!(null==i?void 0:i.length)&&(0,s.jsx)("div",{className:"mb-3 mt-2",children:(0,s.jsx)("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:i.map((e,n)=>{let t=(0,z.j9)(e)?e.sha:e.link;return(0,s.jsx)("div",{children:(0,s.jsxs)(ei.zs,{openDelay:100,closeDelay:100,children:[(0,s.jsx)(ei.Yi,{asChild:!0,children:(0,s.jsx)(eg,{doc:e})}),(0,s.jsx)(ei.bZ,{className:"w-96 bg-background text-sm text-foreground dark:border-muted-foreground/60",children:(0,s.jsx)(ed.Z,{enableDeveloperMode:d,relevantDocument:e,onLinkClick:e=>{window.open(e)}})})]})},"".concat(t,"_").concat(n))})})})})]})})]})})}function eg(e){let{doc:n}=e,t=(0,z.LM)(n),l=(0,a.useMemo)(()=>{if(!t)return null;try{return n?new URL(n.link):null}catch(e){return null}},[n]);return t&&l?(0,s.jsx)("div",{className:"whitespace-nowrap rounded-md bg-muted px-1.5 py-0.5 font-semibold",children:(0,s.jsxs)("div",{className:"m-0 flex items-center space-x-1 text-xs text-muted-foreground group-hover:text-foreground",children:[(0,s.jsx)(ep.V,{hostname:l.hostname,className:"m-0 mr-1"}),(0,s.jsx)("p",{className:"m-0 ",children:l.hostname})]})}):null}function ej(e){let{doc:n}=e;return(0,z._n)(n)?(0,s.jsxs)("div",{className:"m-0 flex items-center space-x-1 text-xs text-muted-foreground group-hover:text-foreground",children:[(0,s.jsx)(U.IconBookOpen,{className:"h-3 w-3"}),(0,s.jsx)("p",{children:(0,z.PJ)(n.title,20)})]}):null}function eb(e){var n,t,l,i,r,o,c,u,m,h,x,f;let{className:p,message:v,userMessage:j,showRelatedQuestion:N,isLoading:w,isLastAssistantMessage:C,isDeletable:y,clientCode:I}=e,{onRegenerateResponse:k,onSubmitSearch:R,setDevPanelOpen:M,setConversationIdForDev:S,enableDeveloperMode:A,contextInfo:L,fetchingContextInfo:D,onDeleteMessage:T,isThreadOwner:F,onUpdateMessage:E,repositories:O}=(0,a.useContext)(em),[P]=(0,g.qB)(),{supportsOnApplyInEditorV2:Z}=(0,a.useContext)(et.p),[Q,q]=(0,a.useState)(!1),V=w?U.IconSpinner:U.IconSparkles,$=(0,a.useMemo)(()=>{var e;if(!v.codeSourceId||!(null==O?void 0:O.length))return"";let n=O.find(e=>e.sourceId===v.codeSourceId);return null!==(e=null==n?void 0:n.gitUrl)&&void 0!==e?e:""},[v.codeSourceId,O]),B=(0,a.useMemo)(()=>{var e;return(null==I?void 0:I.length)&&null!==(e=I.map(e=>({kind:"file",range:(0,z.OV)(e),filepath:e.filepath||"",content:e.content,gitUrl:$})))&&void 0!==e?e:[]},[I,$]),Y=(0,a.useMemo)(()=>{var e,n,t;return null!==(t=null==v?void 0:null===(n=v.attachment)||void 0===n?void 0:null===(e=n.code)||void 0===e?void 0:e.map(e=>{var n,t;return{kind:"file",range:(0,z.OV)(e),filepath:e.filepath,content:e.content,gitUrl:e.gitUrl,commit:null!==(t=e.commit)&&void 0!==t?t:void 0,extra:{scores:null==e?void 0:null===(n=e.extra)||void 0===n?void 0:n.scores}}}))&&void 0!==t?t:[]},[null==v?void 0:null===(n=v.attachment)||void 0===n?void 0:n.code]),G=(0,a.useMemo)(()=>null==I?void 0:I.map(e=>({...e,gitUrl:$})),[I,$]),H=null==v?void 0:null===(t=v.attachment)||void 0===t?void 0:t.doc,K=((null==G?void 0:G.length)||0)+((null===(i=v.attachment)||void 0===i?void 0:null===(l=i.code)||void 0===l?void 0:l.length)||0),W=(0,a.useMemo)(()=>null==H?void 0:H.filter(e=>(0,z.XK)(e)||(0,z.Jd)(e)||(0,z.j9)(e)),[H]),ee=(0,a.useMemo)(()=>null==H?void 0:H.filter(e=>(0,z.LM)(e)),[H]),el=(0,a.useMemo)(()=>null==H?void 0:H.filter(e=>(0,z._n)(e)),[H]),ei=(0,a.useMemo)(()=>{if(!(null==L?void 0:L.sources)||!(null==j?void 0:j.content))return[];let e=(0,z.b)(j.content,null==L?void 0:L.sources),n=e.filter(e=>(0,z._q)(e.kind)).map(e=>({sourceId:e.id,sourceKind:e.kind,sourceName:e.label}));return(P.value||(null==el?void 0:el.length))&&n.unshift({sourceId:"page",sourceKind:b.ri.Page,sourceName:"Pages"}),n},[null==L?void 0:L.sources,null==j?void 0:j.content,P.value,null==el?void 0:el.length]),er=e=>{let n=(0,z.OV)(e);if(!e.filepath)return;let t=new URL("".concat(window.location.origin,"/files")),s=new URLSearchParams;s.append("redirect_filepath",e.filepath),s.append("redirect_git_url",e.gitUrl),e.commit&&s.append("redirect_rev",e.commit),t.search=s.toString();let a=(0,z.nO)(n);a&&(t.hash=a),window.open(t.toString())},eo=async e=>{let n=await E(e);if(n)return n;q(!1)},ed=!!(null===(r=v.readingCode)||void 0===r?void 0:r.fileList)||!!(null===(u=v.attachment)||void 0===u?void 0:null===(c=u.codeFileList)||void 0===c?void 0:null===(o=c.fileList)||void 0===o?void 0:o.length),ec=(null===(m=v.readingCode)||void 0===m?void 0:m.snippet)||!!K,eu=!!v.codeSourceId,ex=!!(null==ei?void 0:ei.length);return(0,s.jsxs)("div",{className:(0,z.cn)("flex flex-col gap-y-5",p),children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"mb-1 flex h-8 items-center gap-x-1.5",children:[(0,s.jsx)(V,{className:(0,z.cn)({"animate-spinner":w})}),(0,s.jsx)("p",{className:"text-sm font-bold leading-none",children:"Answer"}),A&&(0,s.jsx)(_.z,{variant:"ghost",size:"icon",onClick:()=>{S(v.id),M(!0)},children:(0,s.jsx)(U.IconBug,{})})]}),(eu||ex)&&(0,s.jsxs)("div",{className:"mb-6 space-y-1.5",children:[eu&&(0,s.jsx)(eh,{clientCodeContexts:B,serverCodeContexts:Y,isReadingFileList:v.isReadingFileList,isReadingCode:v.isReadingCode,isReadingDocs:v.isReadingDocs,codeSourceId:v.codeSourceId,docQuery:!0,docQueryResources:ei,docs:W,codeFileList:null===(h=v.attachment)||void 0===h?void 0:h.codeFileList,readingCode:{fileList:ed,snippet:ec},onContextClick:e=>{if(!e.filepath)return;let n=(0,z.XX)(window.location.origin,e);window.open(n,"_blank")}}),ex&&(0,s.jsx)(ev,{docQuerySources:ei,isReadingDocs:v.isReadingDocs,webDocs:ee,pages:el})]}),w&&!v.content&&(0,s.jsx)(en.O,{className:"mt-1 h-40 w-full"}),Q?(0,s.jsx)(eN,{message:v,onCancel:()=>q(!1),onSubmit:eo}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ea.J,{message:v.content,attachmentDocs:H,attachmentClientCode:G,attachmentCode:null===(x=v.attachment)||void 0===x?void 0:x.code,onCodeCitationClick:e=>{e.gitUrl&&er(e)},contextInfo:L,fetchingContextInfo:D,canWrapLongLines:!w,supportsOnApplyInEditorV2:Z,onLinkClick:e=>{window.open(e)}}),v.error&&(0,s.jsx)(ea.m,{error:v.error}),!w&&!Q&&(0,s.jsxs)("div",{className:"mt-3 flex items-center justify-between text-sm",children:[(0,s.jsx)("div",{className:"flex items-center gap-x-3",children:F&&(0,s.jsxs)(s.Fragment,{children:[!w&&!D&&C&&(0,s.jsxs)(_.z,{className:"flex items-center gap-x-1 px-1 font-normal text-muted-foreground",variant:"ghost",onClick:()=>k(v.id),children:[(0,s.jsx)(U.IconRefresh,{}),(0,s.jsx)("p",{children:"Regenerate"})]}),y&&(0,s.jsxs)(_.z,{className:"flex items-center gap-x-1 px-1 font-normal text-muted-foreground",variant:"ghost",onClick:()=>T(v.id),children:[(0,s.jsx)(U.IconTrash,{}),(0,s.jsx)("p",{children:"Delete"})]})]})}),(0,s.jsxs)("div",{className:"flex items-center gap-x-3",children:[(0,s.jsx)(es.q,{className:"-ml-1.5 gap-x-1 px-1 font-normal text-muted-foreground",value:(e=>{var n,t,s,a,l,i,r,o,c,u,m;if((0,X.Z)(null==e?void 0:null===(n=e.attachment)||void 0===n?void 0:n.doc)&&(0,X.Z)(null==e?void 0:null===(t=e.attachment)||void 0===t?void 0:t.code))return e.content;let h=e.content.replace(J.Hc,e=>{let n=null==e?void 0:e.match(/\d+/);return"[".concat(n,"]")}).trim(),x=null!==(c=null===(a=e.attachment)||void 0===a?void 0:null===(s=a.doc)||void 0===s?void 0:s.map((e,n)=>(0,z.j9)(e)?"[".concat(n+1,"] ").concat(e.sha):"[".concat(n+1,"] ").concat(e.link)).join("\n"))&&void 0!==c?c:"",f=null!==(u=null===(i=e.attachment)||void 0===i?void 0:null===(l=i.doc)||void 0===l?void 0:l.length)&&void 0!==u?u:0,p=null!==(m=null===(o=e.attachment)||void 0===o?void 0:null===(r=o.code)||void 0===r?void 0:r.map((e,n)=>{let t=(0,z.tf)(e),s=(0,d.Z)([e.filepath,t]).join(":");return"[".concat(n+f+1,"] ").concat(s)}).join("\n"))&&void 0!==m?m:"";return"".concat(h,"\n\nCitations:\n").concat(x+p)})(v),text:"Copy"}),F&&(0,s.jsxs)(_.z,{className:"flex items-center gap-x-1 px-1 font-normal text-muted-foreground",variant:"ghost",onClick:e=>q(!0),children:[(0,s.jsx)(U.IconEdit,{}),(0,s.jsx)("p",{children:"Edit"})]})]})]})]})]}),N&&!Q&&!w&&v.threadRelevantQuestions&&v.threadRelevantQuestions.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-1.5",children:[(0,s.jsx)(U.IconLayers,{}),(0,s.jsx)("p",{className:"text-sm font-bold leading-none",children:"Suggestions"})]}),(0,s.jsx)("div",{className:"mt-2 flex flex-col gap-y-3",children:null===(f=v.threadRelevantQuestions)||void 0===f?void 0:f.map((e,n)=>(0,s.jsxs)("div",{className:"flex cursor-pointer items-center justify-between rounded-lg border p-4 py-3 transition-opacity hover:opacity-70",onClick:R.bind(null,e),children:[(0,s.jsx)("p",{className:"w-full overflow-hidden text-ellipsis text-sm",children:e}),(0,s.jsx)(U.IconPlus,{})]},n))})]})]})}function eN(e){let{message:n,onCancel:t,onSubmit:l}=e,i=W.Ry({content:W.Z_().trim()}),r=(0,H.cI)({resolver:(0,G.F)(i),defaultValues:{content:n.content}}),{isSubmitting:o}=r.formState,[d]=(0,a.useState)(n),c=async e=>{let n=await l({...d,content:e.content});n&&(0,T.zG)(r)(n)};return(0,s.jsx)(ee.l0,{...r,children:(0,s.jsxs)("form",{onSubmit:r.handleSubmit(c),children:[(0,s.jsx)(ee.Wi,{control:r.control,name:"content",render:e=>{let{field:n}=e;return(0,s.jsxs)(ee.xJ,{children:[(0,s.jsx)(ee.NI,{children:(0,s.jsx)(K.Z,{autoFocus:!0,minRows:2,maxRows:20,className:"w-full rounded-lg border bg-background p-4 outline-ring",...n})}),(0,s.jsx)(ee.zG,{})]})}}),(0,s.jsxs)("div",{className:"my-4 flex items-center justify-between gap-2 px-2",children:[(0,s.jsx)("div",{children:(0,s.jsx)(ee.zG,{})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(_.z,{type:"button",variant:"outline",onClick:t,className:"min-w-[2rem]",children:"Cancel"}),(0,s.jsxs)(_.z,{type:"submit",disabled:o,children:[o&&(0,s.jsx)(U.IconSpinner,{className:"mr-2 h-4 w-4 animate-spin"}),"Save"]})]})]})]})})}var ew=t(73460),eC=t(63795),ey=t(62202),eI=t(68172),ek=t(61249),eR=t(63743),eM=t(52569),eS=t(7449);function eA(e){let{threadIdFromURL:n,streamingDone:t,threadId:l,onConvertToPage:i,onShare:o}=e,d=(0,r.useRouter)(),{isThreadOwner:c}=(0,a.useContext)(em),[u,m]=(0,a.useState)(!1),[h,x]=(0,a.useState)(!1),[p]=(0,g.B2)(),v=(0,T.Db)(F.zW,{onCompleted(e){e.deleteThread?d.replace("/"):(f.A.error("Failed to delete"),x(!1))},onError(e){f.A.error((null==e?void 0:e.message)||"Failed to delete"),x(!1)}}),j=e=>{e&&(0,D.wh)(),d.push("/")};return(0,s.jsxs)("header",{className:"flex h-16 items-center justify-between px-4 lg:px-10",children:[(0,s.jsx)("div",{className:"flex items-center gap-x-6",children:(0,s.jsxs)(_.z,{variant:"ghost",className:"-ml-1 pl-0 text-sm text-muted-foreground",onClick:()=>j(),children:[(0,s.jsx)(U.IconChevronLeft,{className:"mr-1 h-5 w-5"}),"Home"]})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[t&&n&&(0,s.jsx)(_.z,{variant:"ghost",className:"flex items-center gap-1 px-2 font-normal",onClick:()=>j(!0),children:(0,s.jsx)(U.IconPlus,{})}),t&&l&&(0,s.jsxs)(ey.h_,{modal:!1,children:[(0,s.jsx)(ey.$F,{asChild:!0,children:(0,s.jsx)(_.z,{size:"icon",variant:"ghost",children:(0,s.jsx)(U.IconMore,{})})}),(0,s.jsxs)(ey.AW,{align:"end",children:[!!o&&(0,s.jsxs)(ey.Xi,{className:"cursor-pointer gap-2",onSelect:e=>o(),children:[(0,s.jsx)(U.IconShare,{}),"Share"]}),c&&(0,s.jsxs)(s.Fragment,{children:[!!p.value&&(0,s.jsxs)(ey.Xi,{className:"cursor-pointer gap-2",onSelect:e=>null==i?void 0:i(),children:[(0,s.jsx)(U.IconBookOpen,{}),(0,s.jsx)("span",{children:"Convert to page"}),(0,s.jsx)(eC.C,{variant:"outline",className:"h-3.5 border-secondary-foreground/60 px-1.5 text-[10px] text-secondary-foreground/60",children:"Beta"})]}),(0,s.jsxs)(ey.Xi,{className:"cursor-pointer gap-2 !text-destructive",onSelect:e=>m(!0),children:[(0,s.jsx)(U.IconTrash,{}),"Delete"]})]})]})]}),(0,s.jsx)(eI.q,{children:(0,s.jsx)(eR.T,{})}),(0,s.jsx)(ek.L,{className:"mr-4"}),(0,s.jsx)(eS.Z,{showHome:!1,showSetting:!0,beforeRouteChange:()=>{(0,D.wh)()},children:(0,s.jsx)(eM.SQ,{className:"h-10 w-10 border"})})]}),(0,s.jsx)(ew.aR,{open:u,onOpenChange:m,children:(0,s.jsxs)(ew._T,{children:[(0,s.jsxs)(ew.fY,{children:[(0,s.jsx)(ew.f$,{children:"Delete this thread"}),(0,s.jsx)(ew.yT,{children:"Are you sure you want to delete this thread? This operation is not revertible."})]}),(0,s.jsxs)(ew.xo,{children:[(0,s.jsx)(ew.le,{children:"Cancel"}),(0,s.jsxs)(ew.OL,{className:(0,_.d)({variant:"destructive"}),onClick:e=>{l&&(e.preventDefault(),x(!0),v({id:l}))},children:[h&&(0,s.jsx)(U.IconSpinner,{className:"mr-2 h-4 w-4 animate-spin"}),"Yes, delete it"]})]})]})})]})}function eL(){return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(en.O,{className:"w-full"}),(0,s.jsx)(en.O,{className:"w-[70%]"})]}),(0,s.jsx)(en.O,{className:"h-40 w-full"})]})}var eD=t(66790);let eT=e=>{let{maxHeight:n=196,children:t}=e,[l,i]=(0,a.useState)(!0),[r,o]=(0,a.useState)(!1),d=(0,a.useRef)(null);return(0,a.useEffect)(()=>{d.current&&d.current.scrollHeight>n?o(!0):o(!1)},[n,t]),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{ref:d,className:(0,z.cn)("h-auto overflow-hidden",{"mb-8":r&&l}),style:{maxHeight:l?"".concat(n,"px"):"none"},children:t}),r&&(0,s.jsx)("div",{className:(0,z.cn)({"absolute right-0 -bottom-8 z-10":l,"flex justify-end my-1":!l}),children:(0,s.jsx)(_.z,{variant:"outline",size:"icon",onClick:()=>{i(!l)},children:(0,s.jsx)(U.IconChevronDown,{className:(0,z.cn)({"rotate-180":!l})})})}),l&&r&&(0,s.jsx)("div",{className:"absolute inset-x-0 bottom-0 h-9 bg-gradient-to-t from-background to-transparent"})]})};function eF(e){let{message:n,className:t,...l}=e,i=(0,a.useMemo)(()=>(0,eD.Tu)(n.content),[n.content]),{contextInfo:r,fetchingContextInfo:o}=(0,a.useContext)(em);return(0,s.jsx)("div",{className:(0,z.cn)("font-semibold",t),...l,children:(0,s.jsx)(eT,{children:(0,s.jsx)(ea.J,{message:i,contextInfo:r,supportsOnApplyInEditorV2:!1,fetchingContextInfo:o,className:"text-xl prose-p:mb-2 prose-p:mt-0",headline:!0,canWrapLongLines:!0})})})}let ez={compress:5.3,expand:6.3},e_="_temp_msg_",eU=()=>"".concat(e_).concat((0,x.x0)());function eE(){var e,n,t,l,i;let m=(0,A.aK)(e=>e.pendingUserMessage),[{data:x}]=(0,y.P)(),{updateUrlComponents:j,pathname:B}=(0,R.Z)(),[G,X]=(0,a.useState)(),[H,K]=(0,a.useState)(!1),W=(0,M.xG)(),[J,ee]=(0,a.useState)([]),[en,et]=(0,a.useState)(!0),[es,ea]=(0,a.useState)(!!(null==m?void 0:m.content)),[el,ei]=(0,a.useState)(""),[er,eo]=(0,a.useState)(""),ed=(0,a.useRef)(null),[ec,eu]=(0,a.useState)(!1),[eh]=(0,q.Hb)(),ex=(0,r.useRouter)(),ef=(0,a.useRef)(!1),{theme:ep}=(0,w.X)(),[ev,eg]=(0,a.useState)(!1),[ej,eN]=(0,a.useState)(),ew=(0,a.useRef)(null),[eC,ey]=(0,a.useState)(45),eI=(0,a.useRef)(eC),[ek]=(0,g.m3)(),[eR]=(0,g.qB)(),[eM,eS]=(0,a.useState)(),eD=(0,a.useMemo)(()=>{var e,n;if(G)return null===(n=G.match(/^\/search\/(.*)/))||void 0===n?void 0:null===(e=n[1])||void 0===e?void 0:e.split("-").pop()},[G]),eT=(0,T.Db)(eO),ez=async e=>{let n=J.findIndex(n=>n.id===e.id);if(!(n>-1)||!eM)return Error("Failed to save");{var t;let s=await eT({input:{threadId:eM,id:e.id,content:e.content}});if(null==s||null===(t=s.data)||void 0===t||!t.updateThreadMessage)return(null==s?void 0:s.error)||Error("Failed to save");await ee(t=>{let s=[...t];return s[n]=e,s})}};(0,a.useEffect)(()=>{eD&&eS(eD)},[eD]);let[{data:eE,fetching:eQ}]=(0,p.aM)({query:F.Gx}),[eq,eV]=(0,a.useState)(),[{data:e$,fetching:eB,error:eY}]=(0,p.aM)({query:F.XL,variables:{ids:[eM]},pause:!eM}),[{data:eG,error:eX,fetching:eH,stale:eK}]=(0,p.aM)({query:F.r4,variables:{threadId:eM,first:30,after:eq},pause:!eM||es});(0,a.useEffect)(()=>{var e,n,t,s;if(!eK){if(null==eG?void 0:null===(n=eG.threadMessages)||void 0===n?void 0:null===(e=n.edges)||void 0===e?void 0:e.length){let e=eG.threadMessages.edges.map(e=>e.node).slice();ee(n=>(0,h.Z)([...n,...e],"id"))}if(null==eG?void 0:eG.threadMessages){let e=null==eG?void 0:null===(s=eG.threadMessages)||void 0===s?void 0:null===(t=s.pageInfo)||void 0===t?void 0:t.hasNextPage,n=null==eG?void 0:eG.threadMessages.pageInfo.endCursor;e&&n?eV(n):ea(!0)}}},[eG]);let eW=(0,a.useMemo)(()=>{if(!x)return!1;if(!eD)return!0;let e=null==e$?void 0:e$.threads.edges[0];return!!e&&x.me.id===e.node.userId},[x,e$,eD]),eJ=null==eE?void 0:eE.contextInfo.sources,e0=null==J?void 0:null===(e=J[0])||void 0===e?void 0:e.content,e1=(0,a.useMemo)(()=>eJ&&e0?(0,z.i8)(eJ,e0,{maxLength:v.$I}):"",[eJ,e0]);(0,a.useEffect)(()=>{e1&&(document.title=e1)},[e1]),(0,a.useEffect)(()=>{eX&&!es&&ea(!0)},[eX]);let{sendUserMessage:e4,isLoading:e2,error:e5,answer:e3,stop:e6,regenerate:e7,deleteThreadMessagePair:e8}=(0,S.x)({threadId:eM}),e9=(0,C.d)(e2),{selectedModel:ne,isFetchingModels:nn,models:nt}=(0,I.Vq)(),{isFetchingRepositories:ns,repos:na}=(0,k.Q)(),nl=(0,a.useMemo)(()=>J.find(e=>e.id===ej),[ej,J]),ni=(0,a.useMemo)(()=>{var e,n;return nl?{debugData:null!==(e=null==nl?void 0:nl.debugData)&&void 0!==e?e:null,...(0,c.Z)(null==nl?void 0:nl.attachment,"doc","code")}:{answers:J.filter(e=>e.role===b.uU.Assistant).map(e=>({debugData:null!==(n=e.debugData)&&void 0!==n?n:null,...(0,c.Z)(e,"doc","code")}))}},[ej,null==nl?void 0:null===(n=nl.attachment)||void 0===n?void 0:n.code,null==nl?void 0:null===(t=nl.attachment)||void 0===t?void 0:t.doc,null==nl?void 0:nl.debugData]),nr=(0,a.useMemo)(()=>{let e=[],n={question:null,answer:null};return J.forEach(t=>{t.role===b.uU.User?n.question=t:t.role!==b.uU.Assistant||n.answer||(n.answer=t,e.push(n),n={question:null,answer:null})}),e},[J]),no=(0,a.useMemo)(()=>{var e,n,t;return null!==(t=null===(n=nr.find(e=>{var n;return!!(null===(n=e.answer)||void 0===n?void 0:n.codeSourceId)}))||void 0===n?void 0:null===(e=n.answer)||void 0===e?void 0:e.codeSourceId)&&void 0!==t?t:void 0},[nr]);(0,a.useEffect)(()=>{X(B),H||K(!0)},[B]),(0,a.useEffect)(()=>{H&&!eD&&(()=>{if(!ef.current){if(ef.current=!0,null==m?void 0:m.content){nh(m.content,m.context),(0,A.UP)(void 0);return}eM||((0,D.wh)(),ex.replace("/"))}})()},[H]),(0,a.useEffect)(()=>{es&&setTimeout(()=>{eu(!0)},300)},[es]);let nd=(0,a.useMemo)(()=>!eD&&(0,u.Z)(J,e=>!!e.error),[eD,J]),{isCopied:nc,onShare:nu}=function(e){let{threadIdFromURL:n,threadIdFromStreaming:t,streamingDone:s,updateThreadURL:a,isEphemeral:l}=e,{isCopied:i,copyToClipboard:r}=(0,N.m)({timeout:2e3}),o=(0,T.Db)(F.md,{onError(e){f.A.error(e.message)}}),d=(!n||!0===l)&&s&&t&&a,c=async()=>{if(i)return;let e=window.location.href;d&&(await o({threadId:t}),e=a(t)),r(e)};return{onShare:c,isCopied:i}}({threadIdFromURL:eD,threadIdFromStreaming:eM,streamingDone:!e2,updateThreadURL:e=>{let n=(0,o.Z)(e1),t=(0,d.Z)([n,e]).join("-"),s=j({pathname:"/search/".concat(t),searchParams:{del:["q"]},replace:!0});return location.origin+s},isEphemeral:null==e$?void 0:null===(i=e$.threads.edges[0])||void 0===i?void 0:null===(l=i.node)||void 0===l?void 0:l.isEphemeral});(0,a.useEffect)(()=>{var e,n,t,s,a,l,i,r,o;e3.threadId&&e3.threadId!==eM&&eS(e3.threadId);let d=[...J],c=d.findIndex(e=>e.id===el),u=d.findIndex(e=>e.id===er);if(-1===c||-1===u)return;let m=d[c],h=d[u];h.content=e3.content,(null===(e=h.attachment)||void 0===e?void 0:e.code)||!e3.attachmentsCode||(h.attachment={clientCode:null,doc:(null===(l=h.attachment)||void 0===l?void 0:l.doc)||null,code:e3.attachmentsCode.map(e=>({...e.code,extra:{scores:e.scores}}))||null}),(null===(n=h.attachment)||void 0===n?void 0:n.doc)||!e3.attachmentsDoc||(h.attachment={clientCode:null,doc:e3.attachmentsDoc.map(e=>({...e.doc,extra:{score:e.score}}))||null,code:(null===(i=h.attachment)||void 0===i?void 0:i.code)||null}),!(null===(t=h.attachment)||void 0===t?void 0:t.codeFileList)&&(null==e3?void 0:null===(a=e3.attachmentsFileList)||void 0===a?void 0:null===(s=a.codeFileList)||void 0===s?void 0:s.length)&&(h.attachment={clientCode:null,doc:(null===(r=h.attachment)||void 0===r?void 0:r.doc)||null,codeFileList:{fileList:e3.attachmentsFileList.codeFileList,truncated:e3.attachmentsFileList.truncated},code:(null===(o=h.attachment)||void 0===o?void 0:o.code)||null}),h.threadRelevantQuestions=null==e3?void 0:e3.relevantQuestions,"isReadingCode"in e3&&(h.isReadingCode=e3.isReadingCode),"isReadingFileList"in e3&&(h.isReadingFileList=e3.isReadingFileList),"isReadingDocs"in e3&&(h.isReadingDocs=e3.isReadingDocs),h.readingCode=null==e3?void 0:e3.readingCode,h.debugData=null==e3?void 0:e3.debugData;let x=e3.userMessageId,f=e3.assistantMessageId;x&&f&&x!==m.id&&f!==h.id&&(m.id=x,h.id=f,ei(x),eo(f)),ee(d)},[e2,e3]),(0,a.useEffect)(()=>{if(e5){let e=[...J],n=e.find(e=>e.id===er);n&&(n.error=e5?"401"===e5.message?"Unauthorized":(0,u.Z)(e5.graphQLErrors,e=>{var n;return(null===(n=e.extensions)||void 0===n?void 0:n.code)===v.ir})?"The thread has expired or does not exist.":e5.message||"Failed to fetch":"Failed to fetch")}},[e5]);let nm=(0,a.useRef)();(0,a.useEffect)(()=>(e9.current&&(nm.current=window.setTimeout(()=>{if(!e9.current)return;et(!0);let e=null==ed?void 0:ed.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},300)),e9.current||et(!1),()=>{window.clearTimeout(nm.current)}),[e2]),(0,a.useEffect)(()=>{var e,n,t;ev?(null===(e=ew.current)||void 0===e||e.expand(),null===(n=ew.current)||void 0===n||n.resize(eC)):null===(t=ew.current)||void 0===t||t.collapse()},[ev]);let nh=(e,n)=>{let{sourceIdForCodeQuery:t,sourceIdsForDocQuery:s,searchPublic:a}=eZ(no,eR.value,n),l=eU(),i=eU(),r={id:l,role:b.uU.User,content:e},o={id:i,role:b.uU.Assistant,content:"",codeSourceId:t},d=t?{sourceId:t,content:e}:null;ei(l),eo(i),ee([...J].concat([r,o])),e4({content:e},{generateRelevantQuestions:!0,codeQuery:d,docQuery:{sourceIds:s,content:e,searchPublic:!!a},modelName:null==n?void 0:n.modelName,debugOptions:(null==ek?void 0:ek.value)?{returnChatCompletionRequest:!0}:void 0})},nx=(0,a.useMemo)(()=>{var e,n;if(es&&!eB&&eD&&(eY||!(null==e$?void 0:null===(n=e$.threads)||void 0===n?void 0:null===(e=n.edges)||void 0===e?void 0:e.length)))return eY||Error(v.ir)},[e$,eB,eY,es,eD]),nf=eh?{height:"calc(100vh - ".concat(q.wt,")")}:{height:"100vh"};return W?es&&(nx||eX)?(0,s.jsx)(eP,{error:nx||eX,threadIdFromURL:eD}):(0,s.jsx)(em.Provider,{value:{isLoading:e2,onRegenerateResponse:()=>{var e;if(!eM||eQ)return;let n=J.length-1,t=n-1;if(-1===n||t<=-1)return;let s=J[t].id,a=J[n].id,l=J.slice(0,-2),i=J[t],r=J[n],o=(null==r?void 0:r.codeSourceId)||no,d={...i,id:eU()},c={id:eU(),role:b.uU.Assistant,content:"",codeSourceId:o,attachment:{code:null,doc:null,clientCode:null},error:void 0},u=(0,z.b)(d.content,null==eE?void 0:null===(e=eE.contextInfo)||void 0===e?void 0:e.sources),{sourceIdForCodeQuery:m,sourceIdsForDocQuery:h,searchPublic:x}=eZ(o,eR.value,(0,z.G8)(u)),f=m?{sourceId:m,content:d.content}:null,p={sourceIds:h,content:d.content,searchPublic:x};ei(d.id),eo(c.id),ee([...l,d,c]),e7({threadId:eM,userMessageId:s,assistantMessageId:a,userMessage:{content:d.content},threadRunOptions:{generateRelevantQuestions:!0,codeQuery:f,docQuery:p,modelName:ne,debugOptions:(null==ek?void 0:ek.value)?{returnChatCompletionRequest:!0}:void 0}})},onSubmitSearch:nh,setDevPanelOpen:eg,setConversationIdForDev:eN,isPathnameInitialized:H,enableDeveloperMode:ek.value,contextInfo:null==eE?void 0:eE.contextInfo,fetchingContextInfo:eQ,onDeleteMessage:e=>{if(!eM)return;let n=J.findIndex(n=>n.id===e),t=n-1,s=J[n-1];if(-1!==n&&(null==s?void 0:s.role)===b.uU.User){if(s.id.startsWith(e_)&&e.startsWith(e_)){let e=J.slice(0,t).concat(J.slice(n+1));ee(e);return}e8(eM,s.id,e).then(e=>{if(e){f.A.error(e);return}let s=J.slice(0,t).concat(J.slice(n+1));ee(s)})}},isThreadOwner:eW,onUpdateMessage:ez,repositories:na},children:(0,s.jsx)("div",{className:"transition-all",style:nf,children:(0,s.jsxs)(E.pO,{direction:"vertical",onLayout:e=>{(null==e?void 0:e[1])&&ey(e[1])},children:[(0,s.jsxs)(E.ee,{children:[(0,s.jsx)(eA,{threadIdFromURL:eD,streamingDone:!e2,threadId:eM,onConvertToPage:()=>{if(!eM)return;let e=null==J?void 0:J[0].content,n=(0,z.i8)(null!=eJ?eJ:[],e);(0,L.RU)({threadId:eM,title:n}),ex.push("/pages")},onShare:nu}),(0,s.jsx)($.Z,{loading:!es,fallback:(0,s.jsxs)("div",{className:"mx-auto mt-24 w-full space-y-10 px-4 pb-32 lg:max-w-4xl lg:px-0",children:[(0,s.jsx)(eL,{}),(0,s.jsx)(eL,{})]}),children:(0,s.jsxs)("main",{className:"h-[calc(100%-4rem)] pb-8 lg:pb-0",children:[(0,s.jsx)(O.ScrollArea,{className:"h-full",ref:ed,children:(0,s.jsx)("div",{className:"mx-auto px-4 pb-32 lg:max-w-4xl lg:px-0",children:(0,s.jsx)("div",{className:"flex flex-col",children:nr.map((e,n)=>{var t,l;let i=n===nr.length-1;return e.question?(0,s.jsxs)(a.Fragment,{children:[!!e.question&&(0,s.jsx)(eF,{className:"pb-2 pt-8",message:e.question},e.question.id),!!e.answer&&(0,s.jsx)(eb,{className:"pb-8 pt-2",message:e.answer,userMessage:e.question,clientCode:null===(l=e.question)||void 0===l?void 0:null===(t=l.attachment)||void 0===t?void 0:t.clientCode,isLoading:e2&&i,isLastAssistantMessage:i,showRelatedQuestion:i,isDeletable:!e2&&J.length>2},e.answer.id),!i&&(0,s.jsx)(P.Z,{})]},e.question.id):null})})})}),(0,s.jsx)(Q.K,{className:(0,z.cn)("!fixed !bottom-[5.4rem] !right-4 !top-auto z-40 border-muted-foreground lg:!bottom-[2.85rem]",{hidden:ev}),container:ed.current,offset:100,style:"dark"===ep?{"--background":"0 0% 12%"}:{}}),(0,s.jsxs)("div",{className:(0,z.cn)("fixed bottom-5 left-0 z-30 flex min-h-[3rem] w-full flex-col items-center gap-y-2",{"opacity-100 translate-y-0":ec,"opacity-0 translate-y-10":!ec,hidden:ev}),style:Object.assign({transition:"all 0.35s ease-out"},"dark"===ep?{"--background":"0 0% 12%"}:{}),children:[(0,s.jsxs)("div",{className:(0,z.cn)("absolute flex items-center gap-4"),style:eW?{top:"-2.5rem"}:void 0,children:[en&&(0,s.jsxs)(_.z,{className:"bg-background",variant:"outline",onClick:()=>e6(),children:[(0,s.jsx)(U.IconStop,{className:"mr-2"}),"Stop generating"]}),!en&&(0,s.jsxs)(Z.u,{delayDuration:0,children:[(0,s.jsx)(Z.aJ,{asChild:!0,children:(0,s.jsx)("span",{tabIndex:0,children:(0,s.jsxs)(_.z,{className:"gap-2 bg-background",variant:"outline",onClick:nu,disabled:nd,children:[nd?(0,s.jsx)(U.IconInfoCircled,{}):nc?(0,s.jsx)(U.IconCheck,{className:"text-green-600"}):(0,s.jsx)(U.IconShare,{}),"Share Link"]})})}),(0,s.jsx)(Z._v,{hidden:!nd,children:"Please resolve errors in messages before sharing this thread."})]})]}),eW&&(0,s.jsx)("div",{className:(0,z.cn)("relative z-20 flex justify-center self-stretch px-4"),children:(0,s.jsx)(Y.Z,{onSearch:nh,className:"min-h-[5rem] lg:max-w-4xl",placeholder:"Ask a follow up question",isFollowup:!0,isLoading:e2,contextInfo:null==eE?void 0:eE.contextInfo,fetchingContextInfo:eQ,modelName:ne,onSelectModel:e=>{(0,A.Eg)(e)},repoSourceId:no,onSelectRepo:e=>{(0,A.xt)(e)},isInitializingResources:nn||ns,models:nt})})]})]})})]}),(0,s.jsx)(E.Dp,{className:(0,z.cn)("hidden !h-[4px] border-none bg-background shadow-[0px_-4px_4px_rgba(0,0,0,0.2)] hover:bg-blue-500 active:bg-blue-500 dark:shadow-[0px_-4px_4px_rgba(255,255,255,0.2)]",ev&&"block")}),(0,s.jsx)(E.ee,{collapsible:!0,collapsedSize:0,defaultSize:0,ref:ew,onCollapse:()=>eg(!1),className:"z-50",children:(0,s.jsx)(V.b,{onClose:()=>eg(!1),value:ni,isFullScreen:100===eC,onToggleFullScreen:e=>{var n;let t=eI.current;e?t=100:100===t&&(t=45),null===(n=ew.current)||void 0===n||n.resize(t),ey(t),eI.current=eC}})})]})})}):null}let eO=(0,j.BX)("\n  mutation UpdateThreadMessage($input: UpdateMessageInput!) {\n    updateThreadMessage(input: $input)\n  }\n");function eP(e){let{error:n,threadIdFromURL:t}=e;return n.message===v.ir?(0,s.jsx)(B.default,{}):(0,s.jsxs)("div",{className:"flex h-screen flex-col",children:[(0,s.jsx)(eA,{threadIdFromURL:t}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsxs)("div",{className:"flex h-full flex-col items-center justify-center gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(U.IconFileSearch,{className:"h-6 w-6"}),(0,s.jsx)("div",{className:"text-xl font-semibold",children:"Something went wrong"})]}),(0,s.jsx)("div",{children:"Failed to fetch the thread, please refresh the page or start a new thread"}),(0,s.jsxs)(i(),{href:"/",onClick:D.wh,className:(0,z.cn)((0,_.d)(),"mt-4 gap-2"),children:[(0,s.jsx)(U.IconPlus,{}),(0,s.jsx)("span",{children:"New Thread"})]})]})})]})}function eZ(e,n,t){let s=(0,d.Z)([e]),a=e,l=!1;if(t){var i;s=(0,m.Z)((0,d.Z)([e,null==t?void 0:t.codeSourceId,n?"page":void 0].concat(t.docSourceIds))),l=null!==(i=t.searchPublic)&&void 0!==i&&i,a=e||t.codeSourceId||void 0}return{sourceIdsForDocQuery:s,sourceIdForCodeQuery:a,searchPublic:l}}},17448:function(e,n,t){"use strict";t.d(n,{p:function(){return a}});var s=t(3546);let a=(0,s.createContext)({})},94779:function(e,n,t){"use strict";t.d(n,{b:function(){return x}});var s=t(36164),a=t(3546),l=t(93877),i=t(28312),r=t(9010),o=t(73492),d=t(31458),c=t(81565),u=t(57830),m=t(90379);let h=(0,a.lazy)(()=>t.e(726).then(t.t.bind(t,80726,23))),x=e=>{let{value:n,isFullScreen:t,onToggleFullScreen:x,onClose:f,scrollOnUpdate:p=!0}=e,[v]=(0,l.m3)(),{theme:g}=(0,r.X)(),j=(0,a.useRef)(null),{copyToClipboard:b}=(0,i.m)({timeout:0});return((0,a.useEffect)(()=>{if(n&&p){var e;null===(e=j.current)||void 0===e||e.scrollTo({top:0,behavior:"smooth"})}},[n]),(null==v?void 0:v.value)&&open)?(0,s.jsxs)("div",{className:"flex h-full flex-col px-3 pt-2",children:[(0,s.jsx)("div",{className:"flex items-center justify-end pb-2",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(d.z,{variant:"ghost",size:"icon",onClick:e=>x(!t),children:(0,s.jsx)(c.IconChevronDown,{className:(0,o.cn)("transition-all",t?"":"rotate-180")})}),(0,s.jsx)(d.z,{variant:"ghost",size:"icon",onClick:f,children:(0,s.jsx)(c.IconClose,{})})]})}),(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)(m.cg,{className:"p-2"}),children:n?(0,s.jsx)(u.ScrollArea,{className:"flex-1",ref:j,children:(0,s.jsx)(h,{theme:"dark"===g?"tomorrow":"rjv-default",src:n,style:{fontSize:"0.75rem"},collapseStringsAfterLength:120,displayObjectSize:!1,displayDataTypes:!1,enableClipboard:e=>{let{src:n}=e;"string"==typeof n&&b(n)}})}):null})]}):null}},69579:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return v}});var s=t(36164),a=t(42891),l=t.n(a),i=t(70652),r=t.n(i),o=t(83332),d=t(76531),c=t(73492),u=t(68172),m=t(30601),h=t(63743),x=t(31458),f=t(52569),p=t(7449);function v(){let[e]=(0,m.Hb)(),n=e?{height:"calc(100vh - ".concat(m.wt,")")}:{height:"100vh"};return(0,s.jsxs)("div",{style:n,className:"flex flex-col",children:[(0,s.jsx)(g,{}),(0,s.jsxs)("div",{className:"flex flex-1 flex-col items-center justify-center",children:[(0,s.jsx)("h2",{className:"mt-4 text-6xl font-bold tracking-tight text-foreground sm:text-7xl",children:"404"}),(0,s.jsx)("p",{className:"mt-4 text-lg text-muted-foreground",children:"Oops, it looks like the page you're looking for doesn't exist."}),(0,s.jsx)(r(),{className:(0,c.cn)("mt-6",(0,x.d)()),href:"/",children:"Home"})]})]})}function g(){return(0,s.jsxs)("header",{className:"flex h-16 items-center justify-between border-b px-4 lg:px-10",children:[(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsxs)(r(),{href:"/",children:[(0,s.jsx)(l(),{src:d.Z,alt:"logo",width:128,className:"dark:hidden"}),(0,s.jsx)(l(),{src:o.Z,alt:"logo",width:96,className:"hidden dark:block"})]})}),(0,s.jsxs)("div",{className:"flex items-center gap-6",children:[(0,s.jsx)(u.q,{children:(0,s.jsx)(h.T,{})}),(0,s.jsx)(p.Z,{showSetting:!0,children:(0,s.jsx)(f.SQ,{className:"h-10 w-10 border"})})]})]})}},65858:function(e,n,t){"use strict";t.d(n,{Qd:function(){return d},UQ:function(){return o},o4:function(){return c},vF:function(){return u}});var s=t(36164),a=t(3546),l=t(43739),i=t(14079),r=t(73492);let o=l.fC,d=a.forwardRef((e,n)=>{let{className:t,...a}=e;return(0,s.jsx)(l.ck,{ref:n,className:(0,r.cn)("border-b",t),...a})});d.displayName="AccordionItem";let c=a.forwardRef((e,n)=>{let{className:t,children:a,showChevron:o=!0,...d}=e;return(0,s.jsxs)(l.xz,{ref:n,className:(0,r.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",t),...d,children:[a,o&&(0,s.jsx)(i.Z,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})});c.displayName=l.xz.displayName;let u=a.forwardRef((e,n)=>{let{className:t,children:a,...i}=e;return(0,s.jsx)(l.VY,{ref:n,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...i,children:(0,s.jsx)("div",{className:(0,r.cn)("pb-4 pt-0",t),children:a})})});u.displayName=l.VY.displayName},73460:function(e,n,t){"use strict";t.d(n,{OL:function(){return v},_T:function(){return m},aR:function(){return o},f$:function(){return f},fY:function(){return h},le:function(){return g},vW:function(){return d},xo:function(){return x},yT:function(){return p}});var s=t(36164),a=t(3546),l=t(91460),i=t(73492),r=t(31458);let o=l.fC,d=l.xz,c=e=>{let{className:n,children:t,...a}=e;return(0,s.jsx)(l.h_,{className:(0,i.cn)(n),...a,children:(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-end justify-center sm:items-center",children:t})})};c.displayName=l.h_.displayName;let u=a.forwardRef((e,n)=>{let{className:t,children:a,...r}=e;return(0,s.jsx)(l.aV,{className:(0,i.cn)("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm transition-opacity animate-in fade-in",t),...r,ref:n})});u.displayName=l.aV.displayName;let m=a.forwardRef((e,n)=>{let{className:t,...a}=e;return(0,s.jsxs)(c,{children:[(0,s.jsx)(u,{}),(0,s.jsx)(l.VY,{ref:n,className:(0,i.cn)("fixed z-50 grid w-full max-w-lg scale-100 gap-4 border bg-background p-6 opacity-100 shadow-lg animate-in fade-in-90 slide-in-from-bottom-10 sm:rounded-lg sm:zoom-in-90 sm:slide-in-from-bottom-0 md:w-full",t),...a})]})});m.displayName=l.VY.displayName;let h=e=>{let{className:n,...t}=e;return(0,s.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-2 text-center sm:text-left",n),...t})};h.displayName="AlertDialogHeader";let x=e=>{let{className:n,...t}=e;return(0,s.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",n),...t})};x.displayName="AlertDialogFooter";let f=a.forwardRef((e,n)=>{let{className:t,...a}=e;return(0,s.jsx)(l.Dx,{ref:n,className:(0,i.cn)("text-lg font-semibold",t),...a})});f.displayName=l.Dx.displayName;let p=a.forwardRef((e,n)=>{let{className:t,...a}=e;return(0,s.jsx)(l.dk,{ref:n,className:(0,i.cn)("text-sm text-muted-foreground",t),...a})});p.displayName=l.dk.displayName;let v=a.forwardRef((e,n)=>{let{className:t,...a}=e;return(0,s.jsx)(l.aU,{ref:n,className:(0,i.cn)((0,r.d)(),t),...a})});v.displayName=l.aU.displayName;let g=a.forwardRef((e,n)=>{let{className:t,...a}=e;return(0,s.jsx)(l.$j,{ref:n,className:(0,i.cn)((0,r.d)({variant:"outline"}),"mt-2 sm:mt-0",t),...a})});g.displayName=l.$j.displayName},98150:function(e,n,t){"use strict";t.d(n,{NI:function(){return p},Wi:function(){return u},l0:function(){return d},lX:function(){return f},pf:function(){return v},xJ:function(){return x},zG:function(){return g}});var s=t(36164),a=t(3546),l=t(74047),i=t(5493),r=t(73492),o=t(5266);let d=i.RV,c=a.createContext({}),u=e=>{let{...n}=e;return(0,s.jsx)(c.Provider,{value:{name:n.name},children:(0,s.jsx)(i.Qr,{...n})})},m=()=>{let e=a.useContext(c),n=a.useContext(h),{getFieldState:t,formState:s}=(0,i.Gc)(),l=e.name||"root",r=t(l,s);if(!s)throw Error("useFormField should be used within <Form>");let{id:o}=n;return{id:o,name:l,formItemId:"".concat(o,"-form-item"),formDescriptionId:"".concat(o,"-form-item-description"),formMessageId:"".concat(o,"-form-item-message"),...r}},h=a.createContext({}),x=a.forwardRef((e,n)=>{let{className:t,...l}=e,i=a.useId();return(0,s.jsx)(h.Provider,{value:{id:i},children:(0,s.jsx)("div",{ref:n,className:(0,r.cn)("space-y-2",t),...l})})});x.displayName="FormItem";let f=a.forwardRef((e,n)=>{let{className:t,required:a,...l}=e,{error:i,formItemId:d}=m();return(0,s.jsx)(o._,{ref:n,className:(0,r.cn)(i&&"text-destructive",a&&'after:ml-0.5 after:text-destructive after:content-["*"]',t),htmlFor:d,...l})});f.displayName="FormLabel";let p=a.forwardRef((e,n)=>{let{...t}=e,{error:a,formItemId:i,formDescriptionId:r,formMessageId:o}=m();return(0,s.jsx)(l.g7,{ref:n,id:i,"aria-describedby":a?"".concat(r," ").concat(o):"".concat(r),"aria-invalid":!!a,...t})});p.displayName="FormControl";let v=a.forwardRef((e,n)=>{let{className:t,...a}=e,{formDescriptionId:l}=m();return(0,s.jsx)("div",{ref:n,id:l,className:(0,r.cn)("text-sm text-muted-foreground",t),...a})});v.displayName="FormDescription";let g=a.forwardRef((e,n)=>{let{className:t,children:a,...l}=e,{error:i,formMessageId:o}=m(),d=i?String(null==i?void 0:i.message):a;return d?(0,s.jsx)("p",{ref:n,id:o,className:(0,r.cn)("text-sm font-medium text-destructive",t),...l,children:d}):null});g.displayName="FormMessage"},53538:function(e,n,t){"use strict";t.d(n,{Dp:function(){return o},ee:function(){return r},pO:function(){return i}});var s=t(36164),a=t(6618),l=t(73492);let i=e=>{let{className:n,...t}=e;return(0,s.jsx)(a.eh,{className:(0,l.cn)("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",n),...t})},r=a.s_,o=e=>{let{withHandle:n,className:t,...i}=e;return(0,s.jsx)(a.OT,{className:(0,l.cn)("border-bg relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",t),...i,children:n&&(0,s.jsx)("div",{className:"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border"})})}},25600:function(e,n,t){"use strict";t.d(n,{FF:function(){return v},Tu:function(){return p},aM:function(){return c},bC:function(){return g},sw:function(){return u},ue:function(){return f},yo:function(){return d}});var s=t(36164),a=t(3546),l=t(4318),i=t(98641),r=t(1663),o=t(73492);let d=l.fC,c=l.xz,u=l.x8,m=l.h_,h=a.forwardRef((e,n)=>{let{className:t,...a}=e;return(0,s.jsx)(l.aV,{className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...a,ref:n})});h.displayName=l.aV.displayName;let x=(0,i.j)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),f=a.forwardRef((e,n)=>{let{side:t="right",className:a,children:i,...d}=e;return(0,s.jsxs)(m,{children:[(0,s.jsx)(h,{}),(0,s.jsxs)(l.VY,{ref:n,className:(0,o.cn)(x({side:t}),a),...d,children:[i,(0,s.jsxs)(l.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,s.jsx)(r.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});f.displayName=l.VY.displayName;let p=e=>{let{className:n,...t}=e;return(0,s.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-2 text-center sm:text-left",n),...t})};p.displayName="SheetHeader";let v=e=>{let{className:n,...t}=e;return(0,s.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",n),...t})};v.displayName="SheetFooter";let g=a.forwardRef((e,n)=>{let{className:t,...a}=e;return(0,s.jsx)(l.Dx,{ref:n,className:(0,o.cn)("text-lg font-semibold text-foreground",t),...a})});g.displayName=l.Dx.displayName;let j=a.forwardRef((e,n)=>{let{className:t,...a}=e;return(0,s.jsx)(l.dk,{ref:n,className:(0,o.cn)("text-sm text-muted-foreground",t),...a})});j.displayName=l.dk.displayName},44645:function(e,n,t){"use strict";t.d(n,{Z:function(){return l}});var s=t(3546),a=t(11978);function l(){let e=(0,a.usePathname)(),n=(0,a.useRouter)(),t=(0,a.useSearchParams)(),l=(0,s.useCallback)(e=>{let n=new URLSearchParams(t.toString());e&&Object.entries(e).forEach(e=>{let[t,s]=e;return n.set(t,s)});let s=n.toString();return s.length>0?"?".concat(s):""},[t]),i=(0,s.useCallback)(s=>{let a=function(e,n,t){var s,a;let l=null===(s=t.searchParams)||void 0===s?void 0:s.set,i=null===(a=t.searchParams)||void 0===a?void 0:a.del,r=new URLSearchParams(n.toString());l&&Object.entries(l).forEach(e=>{let[n,t]=e;return r.set(n,t)}),i&&(Array.isArray(i)?i.forEach(e=>r.delete(e)):r.delete(i));let o=r.toString(),d=e;return o.length>0&&(d+="?".concat(o)),t.hash&&(d+="#".concat(t.hash.replace(/^#/,""))),d}((null==s?void 0:s.pathname)||e,t,s);return s.replace?n.replace(a):n.push(a),a},[e,t]);return{pathname:e,router:n,searchParams:t,getQueryString:l,updateUrlComponents:i}}},64566:function(e,n,t){"use strict";t.d(n,{x:function(){return u}});var s=t(3546),a=t(43240),l=t(11634),i=t(16784);let r=(0,a.BX)("\n  subscription CreateThreadAndRun($input: CreateThreadAndRunInput!) {\n    createThreadAndRun(input: $input) {\n      __typename\n      ... on ThreadCreated {\n        id\n      }\n      ... on ThreadUserMessageCreated {\n        id\n      }\n      ... on ThreadAssistantMessageCreated {\n        id\n      }\n      ... on ThreadAssistantMessageReadingCode {\n        snippet\n        fileList\n      }\n      ... on ThreadRelevantQuestions {\n        questions\n      }\n      ... on ThreadAssistantMessageAttachmentsCodeFileList {\n        codeFileList: fileList\n        truncated\n      }\n      ... on ThreadAssistantMessageAttachmentsCode {\n        hits {\n          code {\n            gitUrl\n            commit\n            filepath\n            language\n            content\n            startLine\n          }\n          scores {\n            rrf\n            bm25\n            embedding\n          }\n        }\n      }\n      ... on ThreadAssistantMessageAttachmentsDoc {\n        hits {\n          doc {\n            __typename\n            ... on MessageAttachmentWebDoc {\n              title\n              link\n              content\n            }\n            ... on MessageAttachmentIssueDoc {\n              title\n              link\n              author {\n                id\n                email\n                name\n              }\n              body\n              closed\n            }\n            ... on MessageAttachmentPullDoc {\n              title\n              link\n              author {\n                id\n                email\n                name\n              }\n              body\n              merged\n            }\n            ... on MessageAttachmentCommitDoc {\n              sha\n              message\n              author {\n                id\n                email\n                name\n              }\n              authorAt\n            }\n            ... on MessageAttachmentPageDoc {\n              link\n              title\n              content\n            }\n          }\n          score\n        }\n      }\n      ... on ThreadAssistantMessageContentDelta {\n        delta\n      }\n      ... on ThreadAssistantMessageCompleted {\n        debugData {\n          chatCompletionMessages {\n            role\n            content\n          }\n        }\n      }\n    }\n  }\n"),o=(0,a.BX)("\n  subscription CreateThreadRun($input: CreateThreadRunInput!) {\n    createThreadRun(input: $input) {\n      __typename\n      ... on ThreadCreated {\n        id\n      }\n      ... on ThreadUserMessageCreated {\n        id\n      }\n      ... on ThreadAssistantMessageCreated {\n        id\n      }\n      ... on ThreadAssistantMessageReadingCode {\n        snippet\n        fileList\n      }\n      ... on ThreadRelevantQuestions {\n        questions\n      }\n      ... on ThreadAssistantMessageAttachmentsCodeFileList {\n        codeFileList: fileList\n        truncated\n      }\n      ... on ThreadAssistantMessageAttachmentsCode {\n        hits {\n          code {\n            gitUrl\n            commit\n            filepath\n            language\n            content\n            startLine\n          }\n          scores {\n            rrf\n            bm25\n            embedding\n          }\n        }\n      }\n      ... on ThreadAssistantMessageAttachmentsDoc {\n        hits {\n          doc {\n            __typename\n            ... on MessageAttachmentWebDoc {\n              title\n              link\n              content\n            }\n            ... on MessageAttachmentIssueDoc {\n              title\n              link\n              author {\n                id\n                email\n                name\n              }\n              body\n              closed\n            }\n            ... on MessageAttachmentPullDoc {\n              title\n              link\n              author {\n                id\n                email\n                name\n              }\n              body\n              merged\n            }\n            ... on MessageAttachmentCommitDoc {\n              sha\n              message\n              author {\n                id\n                email\n                name\n              }\n              authorAt\n            }\n            ... on MessageAttachmentPageDoc {\n              link\n              title\n              content\n            }\n          }\n          score\n        }\n      }\n      ... on ThreadAssistantMessageContentDelta {\n        delta\n      }\n      ... on ThreadAssistantMessageCompleted {\n        debugData {\n          chatCompletionMessages {\n            role\n            content\n          }\n        }\n      }\n    }\n  }\n"),d=(0,a.BX)("\n  mutation DeleteThreadMessagePair(\n    $threadId: ID!\n    $userMessageId: ID!\n    $assistantMessageId: ID!\n  ) {\n    deleteThreadMessagePair(\n      threadId: $threadId\n      userMessageId: $userMessageId\n      assistantMessageId: $assistantMessageId\n    )\n  }\n"),c=()=>({content:"",completed:!1,isReadingCode:!1,isReadingFileList:!1,isReadingDocs:!0});function u(e){let{threadId:n,onAssistantMessageCompleted:t}=e,[a,u]=s.useState(n),m=s.useRef(),[h,x]=s.useState(!1),[f,p]=s.useState(c()),[v,g]=s.useState(),j=(e,n)=>{let t={...e};switch(n.__typename){case"ThreadCreated":t.threadId=n.id;break;case"ThreadUserMessageCreated":t.userMessageId=n.id;break;case"ThreadAssistantMessageCreated":t.assistantMessageId=n.id;break;case"ThreadRelevantQuestions":t.relevantQuestions=n.questions;break;case"ThreadAssistantMessageReadingCode":t.isReadingCode=!0,t.isReadingFileList=!0,t.isReadingDocs=!0,t.readingCode={fileList:n.fileList,snippet:n.snippet};break;case"ThreadAssistantMessageAttachmentsCodeFileList":t.isReadingFileList=!1,t.attachmentsFileList=n;break;case"ThreadAssistantMessageAttachmentsCode":t.isReadingCode=!1,t.attachmentsCode=n.hits;break;case"ThreadAssistantMessageAttachmentsDoc":t.attachmentsDoc=n.hits,t.isReadingDocs=!1;break;case"ThreadAssistantMessageContentDelta":t.isReadingCode=!1,t.isReadingFileList=!1,t.isReadingDocs=!1,t.content+=n.delta;break;case"ThreadAssistantMessageCompleted":t.debugData=n.debugData,t.completed=!0}return t},b=(0,i.d)(e=>{var n;null===(n=m.current)||void 0===n||n.call(m),m.current=void 0,x(!1),p(e=>({...e,isReadingCode:!1,isReadingFileList:!1,isReadingDocs:!1,completed:!0})),!e&&a&&(null==t||t(f))});s.useEffect(()=>{n!==a&&u(n)},[n]);let N=(e,n)=>{let{unsubscribe:t}=l.Lp.subscription(r,{input:{thread:{userMessage:e},options:n}}).subscribe(e=>{var n;if(null==e?void 0:e.error){x(!1),g(e.error),t();return}let s=null===(n=e.data)||void 0===n?void 0:n.createThreadAndRun;s&&((null==s?void 0:s.__typename)==="ThreadAssistantMessageCompleted"&&b.current(),(null==s?void 0:s.__typename)==="ThreadCreated"&&s.id!==a&&u(s.id),p(e=>j(e,s)))});return t},w=(e,n)=>{if(!a)return;let{unsubscribe:t}=l.Lp.subscription(o,{input:{threadId:a,additionalUserMessage:e,options:n}}).subscribe(e=>{var n;if(null==e?void 0:e.error){x(!1),g(e.error),t();return}let s=null===(n=e.data)||void 0===n?void 0:n.createThreadRun;s&&("ThreadAssistantMessageCompleted"===s.__typename&&b.current(),p(e=>j(e,s)))});return t},C=(0,l.Db)(d),y=(e,n)=>{h||(x(!0),g(void 0),p(c()),a?m.current=w(e,n):m.current=N(e,n))},I=(e,n,t)=>C({threadId:e,userMessageId:n,assistantMessageId:t}).then(e=>{var n;if(!(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.deleteThreadMessagePair)){if(null==e?void 0:e.error)throw e.error;throw Error("Failed to fetch")}});return{isLoading:h,answer:f,error:v,sendUserMessage:y,stop:b.current,regenerate:e=>a?(x(!0),g(void 0),p(c()),I(e.threadId,e.userMessageId,e.assistantMessageId).then(()=>{y(e.userMessage,e.threadRunOptions)}).catch(e=>{let n=e instanceof Error?e:Error("Failed to fetch");g(n),x(!1)})):Promise.resolve(void 0),deleteThreadMessagePair:I}}},96274:function(e,n,t){"use strict";t.d(n,{BO:function(){return o},RU:function(){return r},uz:function(){return l}});var s=t(27257);let a={pendingThreadId:void 0,pendingThreadTitle:void 0},l=(0,s.Ue)()(()=>({...a})),i=l.setState,r=e=>{let{threadId:n,title:t}=e;i(()=>({pendingThreadId:n,pendingThreadTitle:t}))},o=()=>{i(()=>({pendingThreadId:void 0,pendingThreadTitle:void 0}))}},76531:function(e,n){"use strict";n.Z={src:"/_next/static/media/logo.526f7cf9.png",height:184,width:607,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAACCAYAAABllJ3tAAAASklEQVR4nGPsKQh1f/HshV/PqtNtagrC8p++//rDAgQM//9/ZWJifMZYnRqg9+bVq6iZ51+1SP/5ovH//z8eRgbGbwyMjPxA9n0AMi8g2L1xUkUAAAAASUVORK5CYII=",blurWidth:8,blurHeight:2}}},function(e){e.O(0,[7565,8415,4648,6527,4691,55,3594,340,9906,4007,1283,3087,2429,8511,240,4421,3179,7070,1454,1002,1460,6805,4546,6065,9275,5605,3721,7003,6635,2882,2928,9860,5665,965,3492,1565,410,6978,9634,4526,8708,3375,5289,1744],function(){return e(e.s=46576)}),_N_E=e.O()}]);