(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1908],{93634:function(e,t,n){Promise.resolve().then(n.bind(n,77930))},77930:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return y}});var r=n(36164),s=n(3546),l=n(11978),i=n(70787),o=n(97651),a=n.n(o),c=n(28011),u=n(63518),d=n(99092),f=n.n(d),h=n(36327),v=n(40055),x=n(16784),m=n(3765),j=n(70410),g=n(73492),p=n(81565),b=n(54173),w=n(90379),N=n(17484);function y(){var e,t,n,i;let o=(0,l.useRouter)(),d=(0,l.useSearchParams)(),g=d.get("id"),[y,O]=(0,s.useState)([]),[A,B]=(0,s.useState)(-1),[F,I]=(0,s.useState)(),[{data:H,fetching:S},T]=(0,v.aM)({query:j.GG,variables:{ids:[g]},pause:!g}),Y=null==H?void 0:null===(n=H.jobRuns)||void 0===n?void 0:null===(t=n.edges)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.node,C=(0,s.useRef)(),_=!!g&&!S&&!(null==Y?void 0:Y.stdout),{data:M,mutate:R,isLoading:W}=(0,h.Z)(g?["/background-jobs/".concat(g,"/logs"),A+1]:null,e=>{let[t,n]=e;return(0,m.Z)(t,{headers:{Range:"bytes=".concat(n,"-").concat(n+5e4)},responseFormatter:e=>{let t=e.headers.get("Content-Range");if(!t)return null;if(206===e.status){let[n,r]=t.replace(/^bytes\s/,"").split("/"),[s,l]=null==n?void 0:n.split("-");return C.current=parseInt(l),e.text().then(e=>({logs:e,totalBytes:parseInt(r),startByte:parseInt(s),endByte:parseInt(l)}))}},errorHandler:e=>{throw Error(null==e?void 0:e.statusText.toString())}})});(0,s.useEffect)(()=>{if(M){var e;O(e=>(0,u.Z)((0,c.Z)(e,M),(e,t)=>e.startByte===t.startByte&&e.endByte===t.endByte)),I(null!==(e=null==M?void 0:M.totalBytes)&&void 0!==e?e:0)}},[M]);let D=(0,s.useMemo)(()=>{if(null==Y?void 0:Y.stdout)return null==Y?void 0:Y.stdout;let e=y.reduce((e,t)=>e+t.logs,"");return function(e){if(!e)return e;let t=e.split("\n"),n=t[t.length-1],r=n.endsWith("\n");return r?t.join("\n"):t.slice(0,-1).join("\n")}(e)},[null==Y?void 0:Y.stdout,y]),E=(0,N.H)(Y),P=!!F&&(null===(i=y[y.length-1])||void 0===i?void 0:i.endByte)>=F-1,Z=(0,x.d)(()=>{if(!W&&C.current){let e=C.current;setTimeout(()=>{B(e)},100)}});return s.useEffect(()=>{let e;return(null==Y?void 0:Y.createdAt)&&!(null==Y?void 0:Y.finishedAt)&&(e=window.setTimeout(()=>{T(),(P||!y.length)&&R()},5e3)),()=>{e&&clearInterval(e)}},[Y,P,null==y?void 0:y.length]),(0,r.jsx)(r.Fragment,{children:S?(0,r.jsx)(w.cg,{}):(0,r.jsx)("div",{className:"flex flex-1 flex-col items-stretch gap-2",children:Y&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{onClick:()=>{window.history.length<=1?o.push("/jobs"):o.back()},className:"-ml-1 flex cursor-pointer items-center transition-opacity hover:opacity-60",children:[(0,r.jsx)(p.IconChevronLeft,{className:"mr-1 h-6 w-6"}),(0,r.jsx)("h2",{className:"scroll-m-20 text-3xl font-bold tracking-tight first:mt-0",children:(0,N.Y)(Y.job)})]}),(0,r.jsxs)("div",{className:"mb-2 flex gap-x-5 text-sm text-muted-foreground lg:gap-x-10",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(p.IconStopWatch,{}),(0,r.jsxs)("p",{children:["State: ",E]})]}),Y.createdAt&&(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(p.IconClock,{}),(0,r.jsxs)("p",{children:["Created:"," ",f()(Y.createdAt).format("YYYY-MM-DD HH:mm")]})]}),Y.startedAt&&(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(p.IconClock,{}),(0,r.jsxs)("p",{children:["Started:"," ",f()(Y.startedAt).format("YYYY-MM-DD HH:mm")]})]}),Y.createdAt&&Y.finishedAt&&(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(p.IconHistory,{}),(0,r.jsxs)("p",{children:["Duration:"," ",a()(f().duration(f()(Y.finishedAt).diff(Y.startedAt)).asMilliseconds())]})]})]}),(0,r.jsx)("div",{className:"flex flex-1 flex-col",children:(0,r.jsx)(k,{value:D,pending:("Pending"===E||"Running"===E)&&!D,children:_&&!P&&(0,r.jsx)(b.d,{intersectionOptions:{trackVisibility:!0,delay:200,rootMargin:"100px 0px 0px 0px"},onLoad:Z.current,isFetching:W,children:(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)(p.IconSpinner,{})})})})})]})})})}function k(e){let{children:t,className:n,value:s,pending:l,...o}=e;return(0,r.jsxs)("div",{className:(0,g.cn)("relative mt-2 h-[72vh] w-full overflow-y-auto overflow-x-hidden rounded-lg border bg-gray-50 font-mono text-[0.9rem] dark:bg-gray-800",n),...o,children:[l&&!s&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-background/60",children:(0,r.jsx)(p.IconSpinner,{className:"h-8 w-8"})}),!!s&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("pre",{className:"whitespace-pre-wrap p-4",children:(0,r.jsx)(i.Z,{children:s})}),t]})]})}},17484:function(e,t,n){"use strict";n.d(t,{H:function(){return i},Y:function(){return l}});var r=n(74630);let s={scheduler_git:"Git",scheduler_github_gitlab:"Github / Gitlab",web_crawler:"Docs"};function l(e){return e in s?s[e]:e}function i(e){return e?(0,r.Z)(e.exitCode)?e.startedAt?"Running":"Pending":0===e.exitCode?"Success":"Failed":"Pending"}},54173:function(e,t,n){"use strict";n.d(t,{d:function(){return a}});var r=n(36164),s=n(3546),l=n(76297),i=n(73492);let o=e=>{let{onLoad:t,isFetching:n,children:o,className:a,intersectionOptions:c}=e,{ref:u,inView:d}=(0,l.YD)(c);return s.useEffect(()=>{d&&!n&&t()},[d,n]),(0,r.jsx)("div",{className:(0,i.cn)("w-full",a),ref:u,children:null!=o?o:(0,r.jsx)("div",{children:"loading..."})})},a=e=>(0,r.jsx)(o,{...e})},90379:function(e,t,n){"use strict";n.d(t,{PF:function(){return a},cg:function(){return i},tB:function(){return o}});var r=n(36164),s=n(73492),l=n(3448);let i=e=>{let{className:t,...n}=e;return(0,r.jsxs)("div",{className:(0,s.cn)("space-y-3",t),...n,children:[(0,r.jsx)(l.O,{className:"h-4 w-full"}),(0,r.jsx)(l.O,{className:"h-4 w-full"}),(0,r.jsx)(l.O,{className:"h-4 w-full"}),(0,r.jsx)(l.O,{className:"h-4 w-full"})]})},o=e=>{let{className:t,...n}=e;return(0,r.jsx)(l.O,{className:(0,s.cn)("h-4 w-full",t),...n})},a=e=>{let{className:t,...n}=e;return(0,r.jsxs)("div",{className:(0,s.cn)("flex flex-col gap-3",t),...n,children:[(0,r.jsx)(l.O,{className:"h-4 w-[20%]"}),(0,r.jsx)(l.O,{className:"h-4 w-full"}),(0,r.jsx)(l.O,{className:"h-4 w-[20%]"}),(0,r.jsx)(l.O,{className:"h-4 w-full"})]})}},3448:function(e,t,n){"use strict";n.d(t,{O:function(){return l}});var r=n(36164),s=n(73492);function l(e){let{className:t,...n}=e;return(0,r.jsx)("div",{className:(0,s.cn)("h-4 animate-pulse rounded-md bg-border",t),...n})}},16784:function(e,t,n){"use strict";n.d(t,{d:function(){return s}});var r=n(3546);function s(e){let t=r.useRef(e);return t.current=e,t}},3765:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(44745),s=n(57778),l=n(79716),i=n(91302),o=n(66794);async function a(e,t){var n;let r=null!==(n=null==t?void 0:t.customFetch)&&void 0!==n?n:window.fetch;if(function(e){var t;if(e.startsWith("/oauth/providers"))return!1;let n=null===(t=(0,o.bW)())||void 0===t?void 0:t.accessToken,r=(0,o.jW)();if(n)try{let{exp:e}=(0,l.o)(n);return(0,o.pw)(e)}catch(e){return!0}else if(r)return!(null==r?void 0:r.authorization);else return!0}(e))return o.gN.refreshToken(c).then(n=>f(e,t));let s=await r(e,u(t));return 401===s.status?(o.gN.clearAccessToken(),o.gN.refreshToken(c).then(n=>f(e,t))):h(s,t)}async function c(){var e,t;let n=null===(e=(0,o.bW)())||void 0===e?void 0:e.refreshToken;if(!n)return;let r=await d(n);return null==r?void 0:null===(t=r.data)||void 0===t?void 0:t.refreshToken}function u(e){var t,n;let r=new Headers(null==e?void 0:e.headers),s=null===(t=(0,o.bW)())||void 0===t?void 0:t.accessToken,l=(0,o.jW)();if(s)r.append("authorization","Bearer ".concat(null===(n=(0,o.bW)())||void 0===n?void 0:n.accessToken));else if(l){let e={Authorization:"Bearer ".concat(l.authorization),...l.headers},t=Object.keys(e);for(let n of t)r.append(n,e[n])}return{...e||{},headers:r}}async function d(e){let t=new r.KU({url:"/graphql",requestPolicy:"network-only",exchanges:[r.Ek]}),n=t.createRequestOperation("mutation",(0,s.h)(i.Dp,{refreshToken:e}));return t.executeMutation(n)}function f(e,t){var n;let r=null!==(n=null==t?void 0:t.customFetch)&&void 0!==n?n:window.fetch;return r(e,u(t)).then(e=>h(e,t))}function h(e,t){return(null==e?void 0:e.ok)?(null==t?void 0:t.responseFormatter)?t.responseFormatter(e):(null==t?void 0:t.responseFormat)==="blob"?e.blob():e.json():(null==t?void 0:t.errorHandler)?t.errorHandler(e):void 0}}},function(e){e.O(0,[7565,8415,5811,55,3594,9906,1454,9934,5366,3492,1565,410,3396,3375,5289,1744],function(){return e(e.s=93634)}),_N_E=e.O()}]);